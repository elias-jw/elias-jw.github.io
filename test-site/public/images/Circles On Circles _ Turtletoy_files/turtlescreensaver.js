var t=Object.defineProperty,e=(e,s,r)=>(((e,s,r)=>{s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[s]=r})(e,"symbol"!=typeof s?s+"":s,r),r);function s(t,e,s){return(1-s)*t+s*e}function r(t){return t<0?0:t>1?1:t}function i(t,e,s){return Math.min(Math.max(t,e),s)}!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();class n{constructor(){e(this,"progress",0),e(this,"requests",[]),e(this,"onComplete"),e(this,"onProgress"),e(this,"loading",!1)}add(t,e){const s={resource:t,status:0,callbacks:[e]};return this.requests.push(s),this.loading&&this.loadResource(s),t}load(t,e){this.loading?console.error("preloader already started"):(this.onComplete=t,this.onProgress=e,this.loading=!0,this.requests.forEach((t=>{this.loadResource(t)})),0===this.requests.length&&this.onComplete&&(this.onComplete(),this.onComplete=void 0))}addOnCompleteForResource(t,e){var s;null==(s=this.requests.find((e=>e.resource===t)))||s.callbacks.push(e)}destruct(){this.onComplete=void 0,this.requests=[]}loadResource(t){0===t.status&&(t.status=1,t.resource.load((()=>{this.loadDoneCallback(t)})))}loadDoneCallback(t){if(2===t.status)return;t.status=2,t.callbacks.forEach((t=>{t&&t()}));const e=this.requests.filter((t=>2===t.status)).length;this.progress+=(1-this.progress)/(1+this.requests.length-e),this.onProgress&&(this.requests.length?this.onProgress(r(this.progress)):this.onProgress(1)),e>=this.requests.length&&this.onComplete&&(this.onComplete(),this.onComplete=void 0)}}let a;function h(){if("undefined"!=typeof document&&!a){a=document.createElement("div");const t=a.style;t.position="fixed",t.left="0",t.bottom="0",t.color="#fff",t.backgroundColor="#22222288",t.overflowX="hidden",t.overflowY="auto !important",t.display="block",t.boxSizing="border-box",t.width="100vw",t.height="30vh",t.padding="16px",t.margin="0",t.font="12px monospace",t.zIndex="998",document.body.appendChild(a)}return a}function o(t,...e){if("undefined"==typeof document)return void console.log(...e);const s=e.length>1&&e[0]&&e[0].toString().indexOf("%c")>=0;e[0]=e[0].toString().replace(/\t/gi,"&nbsp;&nbsp;"),e[0]=e[0].toString().replace(/ /gi,"&nbsp;");let r=`<span ${t?`style="color: ${t}; font-weight: bold;"`:""}>`;if(s){let t=0;r+=e[0].replace(/%c/gi,(()=>(t++,`</span><span style="${e[t]}">`)))}else r+=`${e.map((t=>t&&t!==t.toString()?function(t){let e=[];return JSON.stringify(t,(function(t,s){if("object"==typeof s&&null!==s){if(-1!==e.indexOf(s))return;e.push(s)}return s}))}(t):t)).join(" ")}`;!function(t){const e=h();e&&(e.innerHTML+=t,e.scrollTop=e.scrollHeight)}((r+"</span><br />").replace(/\n/gi,"<br />"))}const c=class t{static get ENABLED(){return t._enabled}static set ENABLED(e){t._enabled=e,t.ENABLED?t.LOG_TO_SCREEN?(t.log=t.screenLog,t.warn=t.screenWarn,t.error=t.screenError):(t.log=console.log,t.warn=console.warn,t.error=t.screenError):(t.log=(...t)=>{},t.warn=(...t)=>{},t.error=t.LOG_TO_SCREEN?t.screenError:console.error)}static get LOG_TO_SCREEN(){return t._logToScreen}static set LOG_TO_SCREEN(e){t._logToScreen=e,t.ENABLED=t.ENABLED}static log(...t){}static error(...t){}static warn(...t){}static screen(...e){!0===t._screenClearFlag&&(!function(){const t=h();t&&(t.innerHTML="")}(),t._screenClearFlag=!1,setTimeout((()=>{t._screenClearFlag=!0}),0)),t.screenLog("",...e);const s=h();s&&(s.style.height="30px")}static screenLog(...t){o("",...t)}static screenWarn(...t){o("#fa4",...t)}static screenError(...e){o("#f44",...e),t.LOG_TO_SCREEN=!0}};e(c,"_enabled",!1),e(c,"_logToScreen",!1),e(c,"_screenClearFlag",!0);let l=c;class d{constructor(t=0,s=0){e(this,"x"),e(this,"y"),this.x=t,this.y=s}static get ZERO(){return new d(0,0)}static get ONE(){return new d(1,1)}static dot(t,e){return t.x*e.x+t.y*e.y}static distance(t,e){const s=t.x-e.x,r=t.y-e.y;return Math.sqrt(s*s+r*r)}static distanceSquared(t,e){const s=t.x-e.x,r=t.y-e.y;return s*s+r*r}static transformMat2(t,e){const s=t.x,r=t.y,i=e.m;return new d(i[0]*s+i[2]*r,i[1]*s+i[3]*r)}static transformMat3(t,e){const s=t.x,r=t.y,i=e.m;return new d(i[0]*s+i[3]*r+i[6],i[1]*s+i[4]*r+i[7])}static transformMat4(t,e){const s=t.x,r=t.y,i=e.m;return new d(i[0]*s+i[4]*r+i[12],i[1]*s+i[5]*r+i[13])}static multiplyScalar(t,e){return new d(t.x*e,t.y*e)}static add(t,e){return new d(t.x+e.x,t.y+e.y)}static sub(t,e){return new d(t.x-e.x,t.y-e.y)}static lerp(t,e,s){const r=t.x,i=t.y;return new d(r+s*(e.x-r),i+s*(e.y-i))}static fract(t){return d.sub(t,d.floor(t))}static floor(t){return new d(Math.floor(t.x),Math.floor(t.y))}static normalize(t){let e=t.x*t.x+t.y*t.y;return e>0&&(e=1/Math.sqrt(e)),t.clone().multiplyScalar(e)}clone(){return new d(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}setValues(t,e){return this.x=t,this.y=e,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}equals(t){return t.x===this.x&&t.y===this.y}normalize(){let t=this.x*this.x+this.y*this.y;return t>0&&(t=1/Math.sqrt(t)),this.x*=t,this.y*=t,this}negate(){return this.x=-this.x,this.y=-this.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}addScalar(t){return this.x+=t,this.y+=t,this}multiplyMatrix(t){const e=t.m,s=e[0]*this.x+e[2]*this.y,r=e[1]*this.x+e[3]*this.y;return this.setValues(s,r)}multiply(t){return this.x*=t.x,this.y*=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}subtract(t){return this.x-=t.x,this.y-=t.y,this}subtractScalar(t){return this.x-=t,this.y-=t,this}rotate(t,e){const s=Math.sin(e),r=Math.cos(e);this.x-=t.x,this.y-=t.y;const i=this.x*r-this.y*s,n=this.x*s+this.y*r;return this.x=i+t.x,this.y=n+t.y,this}randomize(){return this.x=2*Math.random()-1,this.y=2*Math.random()-1,this}randomize01(){return this.x=Math.random(),this.y=Math.random(),this}randomizeDisc(){do{this.randomize()}while(this.length()>1);return this}}class u{constructor(t){if(e(this,"canvas"),e(this,"pixelRatio",1),e(this,"container"),this.container=t,t){this.pixelRatio=window.devicePixelRatio;const e=(null==t?void 0:t.offsetWidth)??32,s=(null==t?void 0:t.offsetHeight)??32;this.canvas=function(t,e){const s=document.createElement("canvas");return s.width=t,s.height=e,s}(e,s),t.offsetWidth*t.offsetHeight<1&&l.error("canvasParent has no area",t),t.appendChild(this.canvas)}else l.error("canvasParent is null")}update(t){if(this.container){const t=this.container.getBoundingClientRect();let e=t.width,s=t.height;if(e*s>0)return this.setSize(e,s);l.warn("canvasParent has no area",this.container)}return!1}setSize(t,e){return(this.canvas.width!==(t*this.pixelRatio|0)||this.canvas.height!==(e*this.pixelRatio|0))&&(this.canvas.width=t*this.pixelRatio|0,this.canvas.height=e*this.pixelRatio|0,"style"in this.canvas&&(this.canvas.style.width=t+"px",this.canvas.style.height=e+"px"),this.canvas.dispatchEvent(new Event("resize")),!0)}destruct(){var t;null==(t=this.container)||t.removeChild(this.canvas)}}const m=34962,x=34963,p=5126,f=32774,g=3089,y=35044,w=5123,v=class t{constructor(s,r,i){e(this,"id"),e(this,"name"),e(this,"drawType",4),e(this,"depthTest",!0),e(this,"depthWrite",!0),e(this,"alphaToCoverage",!1),e(this,"depthFunc",513),e(this,"blend",!1),e(this,"blendEquation"),e(this,"sourceBlend"),e(this,"destinationBlend"),e(this,"shader"),e(this,"culling",1029),e(this,"renderer"),e(this,"blendFuncSeparate",!1),e(this,"sourceBlendRGB",1),e(this,"destinationBlendRGB",0),e(this,"sourceBlendAlpha",1),e(this,"destinationBlendAlpha",0),e(this,"_shaderDefines",{}),this.renderer=s,this.name=r,this.shader=i,this.id=t.staticId++,this.setDefaultBlending()}setActive(){if(this.renderer.renderState.setProgram(this.shader.program),this.shader.getTextureUniforms().forEach((t=>t.bind())),this.renderer.renderState.material!=this&&(this.renderer.renderState.material=this,this.renderer.renderState.setAlphaToCoverage(this.alphaToCoverage),this.renderer.renderState.setDepthTest(this.depthTest),this.renderer.renderState.setDepthMask(this.depthWrite),this.renderer.renderState.setDepthFunc(this.depthFunc),this.renderer.renderState.setCulling(this.culling),this.renderer.renderState.setBlendEnabled(this.blend),this.blend))if(this.renderer.renderState.setBlendEquation(this.blendEquation),this.blendFuncSeparate){if(null===this.sourceBlendRGB||null===this.destinationBlendRGB||null===this.sourceBlendAlpha||null===this.destinationBlendAlpha)throw new ReferenceError("expected blend properties to be set");this.renderer.renderState.setBlendFuncSeparate(this.sourceBlendRGB,this.destinationBlendRGB,this.sourceBlendAlpha,this.destinationBlendAlpha)}else this.renderer.renderState.setBlendFunc(this.sourceBlend,this.destinationBlend)}setDefaultBlending(){this.depthTest=!0,this.depthWrite=!0,this.blend=!1,this.blendEquation=f,this.sourceBlend=0,this.destinationBlend=1}setAlphaBlending(){this.depthWrite=!1,this.depthTest=!0,this.blend=!0,this.blendEquation=f,this.setBlendUnified(770,771)}setPreMultipliedAlphaBlending(){this.depthWrite=!1,this.depthTest=!0,this.blend=!0,this.blendEquation=f,this.setBlendUnified(1,771)}setMaxBlending(){this.depthWrite=!1,this.depthTest=!1,this.blend=!0,this.blendEquation=32776,this.sourceBlend=1,this.destinationBlend=1,this.setBlendUnified(1,1)}setAdditiveBlending(){this.depthWrite=!1,this.depthTest=!0,this.blend=!0,this.blendEquation=f,this.setBlendUnified(1,1)}setMultiplyBlending(){this.depthWrite=!1,this.depthTest=!0,this.blend=!0,this.blendEquation=f,this.setBlendUnified(0,768)}setSubtractiveBlending(){this.depthWrite=!1,this.depthTest=!1,this.blend=!0,this.blendEquation=32778,this.setBlendUnified(1,771)}setBlendUnified(t,e){this.blendFuncSeparate=!1,this.sourceBlend=t,this.destinationBlend=e}setBlendSeparate(t,e,s,r){this.blendFuncSeparate=!0,this.sourceBlendRGB=t,this.sourceBlendAlpha=s,this.destinationBlendRGB=e,this.destinationBlendAlpha=r}setCullingBackFace(){this.culling=1029}setCullingFrontFace(){this.culling=1028}setCullingDisabled(){this.culling=0}setDrawTypePoints(){this.drawType=0}setDrawTypeLines(){this.drawType=1}setDrawTypeLineStrip(){this.drawType=3}setDrawTypeTriangles(){this.drawType=4}setDrawTypeTriangleFan(){this.drawType=6}setDrawTypeTriangleStrip(){this.drawType=5}setFloat(t,e){const s=this.getUniformLocation(t);s&&(this.renderer.renderState.setProgram(this.shader.program),this.renderer.context.uniform1f(s,e))}setInt(t,e){const s=this.getUniformLocation(t);s&&(this.renderer.renderState.setProgram(this.shader.program),this.renderer.context.uniform1i(s,e))}setFloats(t,e=0,s=0,r=0,i=0){const n=this.getUniformLocation(t);n&&(this.renderer.renderState.setProgram(this.shader.program),this.renderer.context.uniform4f(n,e,s,r,i))}setMatrix(t,e){const s=this.getUniformLocation(t);s&&(this.renderer.renderState.setProgram(this.shader.program),this.renderer.context.uniformMatrix4fv(s,!1,e.m))}setMatrix3x3(t,e){const s=this.getUniformLocation(t);s&&(this.renderer.renderState.setProgram(this.shader.program),this.renderer.context.uniformMatrix3fv(s,!1,e.m))}setMatrix2x2(t,e){const s=this.getUniformLocation(t);s&&(this.renderer.renderState.setProgram(this.shader.program),this.renderer.context.uniformMatrix2fv(s,!1,e.m))}setMatrixArray(t,e){e.forEach(((e,s)=>{const r=`${t}[${s}]`;this.setMatrix(r,e)}))}setMatrixArray2(t,e){const s=this.getUniformLocation(t);s&&(this.renderer.renderState.setProgram(this.shader.program),this.renderer.context.uniformMatrix4fv(s,!1,e.m))}setMatrixFloatArray(t,e){const s=this.getUniformLocation(t);s&&(this.renderer.renderState.setProgram(this.shader.program),this.renderer.context.uniformMatrix4fv(s,!1,e))}setMatrix3x3FloatArray(t,e){const s=this.getUniformLocation(t);s&&(this.renderer.renderState.setProgram(this.shader.program),this.renderer.context.uniformMatrix3fv(s,!1,e))}setTexture(t,e){if(!this.shader)throw new ReferenceError("Material has no Shader");const s=this.shader.getTextureUniformByName(t);s&&s.set(e)}unSetTexture(t){const e=this.shader.getTextureUniformByName(t);e&&e.unSet()}setFloat32Array(t,e){const s=this.getUniformLocation(t);s&&(this.renderer.renderState.setProgram(this.shader.program),this.renderer.context.uniform1fv(s,e))}setInt32Array(t,e){const s=this.getUniformLocation(t);s&&(this.renderer.renderState.setProgram(this.shader.program),this.renderer.context.uniform1iv(s,e))}setColor(t,e){const s=this.getUniformLocation(t);s&&(this.renderer.renderState.setProgram(this.shader.program),this.renderer.context.uniform4f(s,e.r,e.g,e.b,e.a))}setVector3(t,e){const s=this.getUniformLocation(t);s&&(this.renderer.renderState.setProgram(this.shader.program),this.renderer.context.uniform3f(s,e.x,e.y,e.z))}setVector3Array(t,e){const s=this.getUniformLocation(t);s&&(this.renderer.renderState.setProgram(this.shader.program),this.renderer.context.uniform3fv(s,e))}setVector2(t,e){const s=this.getUniformLocation(t);s&&(this.renderer.renderState.setProgram(this.shader.program),this.renderer.context.uniform2f(s,e.x,e.y))}setVector2Array(t,e){const s=this.getUniformLocation(t);s&&(this.renderer.renderState.setProgram(this.shader.program),this.renderer.context.uniform2fv(s,e))}setVector4(t,e){const s=this.getUniformLocation(t);s&&(this.renderer.renderState.setProgram(this.shader.program),this.renderer.context.uniform4f(s,e.x,e.y,e.z,e.w))}setVector4Array(t,e){const s=this.getUniformLocation(t);s&&(this.renderer.renderState.setProgram(this.shader.program),this.renderer.context.uniform4fv(s,e))}getUniformLocation(t){return this.shader.getUniformLocation(t)}hasUniform(t){return!!this.getUniformLocation(t)}addShaderDefines(...t){for(let e=0;e<t.length;e++){const s=t[e]instanceof Array?t[e][0]:t[e],r=t[e]instanceof Array?t[e][1]:1;null==this._shaderDefines[s]&&(this._shaderDefines[s]=r)}}getShaderDefines(){return this._shaderDefines}clearShaderDefines(){this._shaderDefines=[]}destruct(){this.shader.destruct()}};e(v,"staticId",0);let _=v;class M{constructor(t,s,r){e(this,"name"),e(this,"stride"),e(this,"loc"),this.name=t,this.stride=s,this.loc=r}}class b{constructor(t,s,r,i){if(e(this,"name"),e(this,"texture",null),e(this,"samplerIndex"),this.name=s,this.samplerIndex=i,!t.program)throw new ReferenceError("Cannot construct TextureUniform from shader: shader is not yet initialized.");t.renderer.renderState.setProgram(t.program),t.renderer.context.uniform1i(r,i)}set(t){this.texture=t}unSet(){this.texture&&this.texture.renderer.renderState.unBindTextureFromSlot(this.texture.textureGL,this.samplerIndex)}bind(){this.texture&&this.texture.bindToSlot(this.samplerIndex)}}const z={},S=[];function E(t,e){z[t]=e}function P(t){for(const[e,s]of Object.entries(t))E(e,s)}function A(t){var e;t=t.replace("./","");const s=null==(e=Object.entries(z).find((([e,s])=>e.includes(t))))?void 0:e[1];return new Promise(s?t=>t(s):e=>{for(const s of S)s().then((s=>{E(t,s),e(s)})).catch((()=>{l.warn(`Failed to load shader source for ${t}`)}))})}function T(t,e){const s=/^#include\s+(\S+)/,r=[];if(t.forEach((t=>{t.split("\n").forEach((t=>{const e=s.exec(t.trim());null!==e&&r.push([e[1],e])}))})),r.length){const s=r.map((t=>t[0]));Promise.all(s.map(A)).then((i=>{t.forEach(((e,n)=>{r.forEach(((r,a)=>{t[n]=e.replace(r[1][0],`\n\n///// Start ${s[a]}\n\n${i[a]}\n\n///// End ${s[a]}\n\n`)}))})),T(t,e)}))}else e(t)}function D(t){const e=/^uniform\s+(\S*)\s+(\S*);/,s={};return t.split("\n").map((t=>{const r=e.exec(t);if(r){const e=r[2];s[e]&&(t="// "+t),s[e]=!0}return t})).join("\n")}function B(t,e,s){const r=t.createShader(s);return t.shaderSource(r,e),t.compileShader(r),r}function C(t){switch(t){case p:case 5124:return 1;case 35664:return 2;case 35665:return 3;case 35666:case 35674:return 4;case 35675:return 9;case 35676:return 16;default:return l.error("attribute type not handled: "+t),-1}}function R(t,e,s){if(e){const r=/ERROR: (\d+):(\d+):/;let i=e.split("\n");const n=[];i.forEach((t=>{const e=r.exec(t);null!==e&&(n[parseInt(e[2],10)-1]=t)})),i=s.split("\n");const a=[""];for(let t=0;t<i.length;t++)a[0]+="%c"+i[t]+"\n",a[t+1]=n[t]?"color: #f44":"",n[t]&&(a[0]+=" --\x3e "+n[t]+"\n");return l.error("Compile error for shader: "+t),l.log(...a),console.log(...a),!0}return!1}const O=class t{constructor(s,r={}){e(this,"id"),e(this,"program"),e(this,"name","unnamed"),e(this,"attributes"),e(this,"renderer"),e(this,"shaderDefines"),e(this,"textureUniforms"),e(this,"uniformLocationsByName"),e(this,"vShader"),e(this,"fShader"),e(this,"vShaderSource",""),e(this,"fShaderSource",""),e(this,"compileStatusChecked",!1),this.id=t.staticId++,this.renderer=s,this.shaderDefines=r}load(t,e){Promise.all([A(`${t}.vs.glsl`),A(`${t}.fs.glsl`)]).then((s=>{T(s,(s=>{this.init(t,s[0],s[1],e)}))}))}init(t,e,s,r=null){if(this.name=t,this.shaderDefines){let t="",r=0;for(let e in this.shaderDefines)t+="#define "+e+" "+this.shaderDefines[e]+"\n",r++;r>0&&(e=t+e,s=t+s)}e=D(e),s=D(s),this.vShaderSource=this.renderer.preprocessShaderString(e),this.fShaderSource=this.renderer.preprocessShaderString(s);const i=this.renderer.context;return this.vShader=B(i,this.vShaderSource,35633),this.fShader=B(i,this.fShaderSource,35632),this.program=function(t,e,s){const r=t.createProgram();return t.attachShader(r,e),t.attachShader(r,s),t.linkProgram(r),r}(i,this.vShader,this.fShader),r&&r.call(this),this}getUniformLocation(t){this.uniformLocationsByName||this.getTextureUniforms();let e=this.uniformLocationsByName[t];return void 0===e&&(e=this.renderer.context.getUniformLocation(this.program,t)||!1,this.uniformLocationsByName[t]=e),e}getTextureUniforms(){if(!this.textureUniforms){this.checkCompileStatus();const t=this.renderer.context,e=t.getProgramParameter(this.program,35718);this.textureUniforms=[],this.uniformLocationsByName={};let s=0;for(let r=0;r<e;r++){const e=t.getActiveUniform(this.program,r),i=t.getUniformLocation(this.program,e.name);this.uniformLocationsByName[e.name]=i,35678!==e.type&&35680!==e.type&&35679!==e.type||(this.textureUniforms.push(new b(this,e.name,i,s)),s++)}}return this.textureUniforms}getAttributes(){if(!this.attributes){this.checkCompileStatus();const t=this.renderer.context,e=t.getProgramParameter(this.program,35721);this.attributes=[];for(let s=0;s<e;s++){const e=t.getActiveAttrib(this.program,s),r=t.getAttribLocation(this.program,e.name),i=C(e.type);this.attributes.push(new M(e.name,i,r))}}return this.attributes}getAttributeByName(t){return this.getAttributes().find((e=>e.name===t))}getTextureUniformByName(t){return this.getTextureUniforms().find((e=>e.name===t))}destruct(){const t=this.renderer.context;t.deleteShader(this.vShader),t.deleteShader(this.fShader),t.deleteProgram(this.program)}checkCompileStatus(){if(!this.compileStatusChecked){this.compileStatusChecked=!0;const t=this.renderer.context;if(t.getProgramParameter(this.program,35714))return;throw R(this.name,t.getShaderInfoLog(this.vShader),this.vShaderSource)||R(this.name,t.getShaderInfoLog(this.fShader),this.fShaderSource)||R(this.name,t.getProgramInfoLog(this.program),this.fShaderSource),new Error("unable to compile shader")}}};e(O,"staticId",0);let V=O;class L extends _{constructor(t,e,s){super(t,s,new V(t)),e.add(this)}load(t){this.shader.shaderDefines=this.getShaderDefines(),this.shader.load(this.name,(()=>{t()}))}}class U{constructor(t=0,s=0,r=0){e(this,"x"),e(this,"y"),e(this,"z"),this.x=t,this.y=s,this.z=r}static get ZERO(){return new U(0,0,0)}static get RIGHT(){return new U(1,0,0)}static get UP(){return new U(0,1,0)}static get FORWARD(){return new U(0,0,1)}static get ONE(){return new U(1,1,1)}get xy(){return new d(this.x,this.y)}get yz(){return new d(this.y,this.z)}get xz(){return new d(this.x,this.z)}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static distance(t,e){const s=t.x-e.x,r=t.y-e.y,i=t.z-e.z;return Math.sqrt(s*s+r*r+i*i)}static add(t,e){return t.clone().add(e)}static sub(t,e){return t.clone().sub(e)}static multiply(t,e){return t.clone().multiply(e)}static divide(t,e){return t.clone().divide(e)}static multiplyScalar(t,e){return t.clone().multiplyScalar(e)}static powScalar(t,e){return t.clone().powScalar(e)}static normalize(t){return t.clone().normalize()}static max(t,e){return t.clone().max(e)}static min(t,e){return t.clone().min(e)}static lerp(t,e,s){return t.clone().lerp(e,s)}static cross(t,e){const s=t.x,r=t.y,i=t.z,n=e.x,a=e.y,h=e.z;return new U(r*h-i*a,i*n-s*h,s*a-r*n)}static fract(t){return new U(t.x-Math.floor(t.x),t.y-Math.floor(t.y),t.z-Math.floor(t.z))}static floor(t){return new U(Math.floor(t.x),Math.floor(t.y),Math.floor(t.z))}static transform(t,e){return t.clone().transform(e)}static transformMat3(t,e){return t.clone().transformMat3(e)}clone(){return new U(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}setValues(t=0,e=0,s=0){return this.x=t,this.y=e,this.z=s,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}normalize(){let t=this.x*this.x+this.y*this.y+this.z*this.z;return t>0&&(t=1/Math.sqrt(t)),this.x*=t,this.y*=t,this.z*=t,this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}powScalar(t){return this.x=Math.pow(this.x,t),this.y=Math.pow(this.y,t),this.z=Math.pow(this.z,t),this}lerp(t,e){return this.x=this.x+(t.x-this.x)*e,this.y=this.y+(t.y-this.y)*e,this.z=this.z+(t.z-this.z)*e,this}rotateX(t,e){const s=this.y-t.y,r=this.z-t.z;return this.y=s*Math.cos(e)-r*Math.sin(e)+t.y,this.z=s*Math.sin(e)+r*Math.cos(e)+t.z,this}rotateY(t,e){const s=this.x-t.x,r=this.z-t.z;return this.x=r*Math.cos(e)-s*Math.sin(e)+t.x,this.z=r*Math.sin(e)+s*Math.cos(e)+t.z,this}rotateZ(t,e){const s=this.x-t.x,r=this.y-t.y;return this.x=s*Math.cos(e)-r*Math.sin(e)+t.x,this.y=s*Math.sin(e)+r*Math.cos(e)+t.y,this}transform(t){const e=this.x,s=this.y,r=this.z,i=t.m;let n=i[3]*e+i[7]*s+i[11]*r+i[15];return n=n||1,this.x=(i[0]*e+i[4]*s+i[8]*r+i[12])/n,this.y=(i[1]*e+i[5]*s+i[9]*r+i[13])/n,this.z=(i[2]*e+i[6]*s+i[10]*r+i[14])/n,this}transformMat3(t){const e=this.x,s=this.y,r=this.z,i=t.m;return this.x=e*i[0]+s*i[3]+r*i[6],this.y=e*i[1]+s*i[4]+r*i[7],this.z=e*i[2]+s*i[5]+r*i[8],this}randomize(){return this.x=2*Math.random()-1,this.y=2*Math.random()-1,this.z=2*Math.random()-1,this}randomize01(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomizeSphere(){do{this.randomize()}while(this.length()>1);return this}}class F{constructor(t=0,s=0,r=0,i=1){e(this,"x"),e(this,"y"),e(this,"z"),e(this,"w"),this.x=t,this.y=s,this.z=r,this.w=i}static get ZERO(){return new F(0,0,0,0)}static get ONE(){return new F(1,1,1,1)}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w}static distance(t,e){const s=e.x-t.x,r=e.y-t.y,i=e.z-t.z,n=e.w-t.w;return Math.sqrt(s*s+r*r+i*i+n*n)}static add(t,e){return t.clone().add(e)}static sub(t,e){return t.clone().sub(e)}static multiply(t,e){return t.clone().multiply(e)}static divide(t,e){return t.clone().divide(e)}static multiplyScalar(t,e){return t.clone().multiplyScalar(e)}static powScalar(t,e){return t.clone().powScalar(e)}static normalize(t){return t.clone().normalize()}static max(t,e){return t.clone().max(e)}static min(t,e){return t.clone().min(e)}static lerp(t,e,s){return t.clone().lerp(e,s)}static cross(t,e,s){const r=e.x*s.y-e.y*s.x,i=e.x*s.z-e.z*s.x,n=e.x*s.w-e.w*s.x,a=e.y*s.z-e.z*s.y,h=e.y*s.w-e.w*s.y,o=e.z*s.w-e.w*s.z,c=t.x,l=t.y,d=t.z,u=t.w,m=new F;return m.x=l*o-d*h+u*a,m.y=-c*o+d*n-u*i,m.z=c*h-l*n+u*r,m.w=-c*a+l*i-d*r,m}static transform(t,e){return t.clone().transform(e)}clone(){return new F(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}setValues(t,e,s,r){return this.x=t,this.y=e,this.z=s,this.w=r,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}normalize(){let t=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;return t>0&&(t=1/Math.sqrt(t)),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}powScalar(t){return this.x=Math.pow(this.x,t),this.y=Math.pow(this.y,t),this.z=Math.pow(this.z,t),this.w=Math.pow(this.w,t),this}lerp(t,e){return this.x=this.x+(t.x-this.x)*e,this.y=this.y+(t.y-this.y)*e,this.z=this.z+(t.z-this.z)*e,this.w=this.w+(t.w-this.w)*e,this}dot(t){return t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w}transform(t){const e=this.x,s=this.y,r=this.z,i=this.w,n=t.m;return this.x=n[0]*e+n[4]*s+n[8]*r+n[12]*i,this.y=n[1]*e+n[5]*s+n[9]*r+n[13]*i,this.z=n[2]*e+n[6]*s+n[10]*r+n[14]*i,this.w=n[3]*e+n[7]*s+n[11]*r+n[15]*i,this}}const I=1e-9;class k{constructor(...t){e(this,"m",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),16===t.length&&(this.m=[...t])}static clone(t){return new k(...t.m)}static copy(t,e){return e.m=[...t.m],e}static identity(t=void 0){const e=(t=t||new k).m;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,t}static transpose(t,e=void 0){const s=(e=e||new k).m,r=t.m;if(s===r){const t=r[1],e=r[2],i=r[3],n=r[6],a=r[7],h=r[11];s[1]=r[4],s[2]=r[8],s[3]=r[12],s[4]=t,s[6]=r[9],s[7]=r[13],s[8]=e,s[9]=n,s[11]=r[14],s[12]=i,s[13]=a,s[14]=h}else s[0]=r[0],s[1]=r[4],s[2]=r[8],s[3]=r[12],s[4]=r[1],s[5]=r[5],s[6]=r[9],s[7]=r[13],s[8]=r[2],s[9]=r[6],s[10]=r[10],s[11]=r[14],s[12]=r[3],s[13]=r[7],s[14]=r[11],s[15]=r[15];return e}static invert(t,e=void 0){const s=(e=e||new k).m,r=t.m,i=r[0],n=r[1],a=r[2],h=r[3],o=r[4],c=r[5],l=r[6],d=r[7],u=r[8],m=r[9],x=r[10],p=r[11],f=r[12],g=r[13],y=r[14],w=r[15],v=i*c-n*o,_=i*l-a*o,M=i*d-h*o,b=n*l-a*c,z=n*d-h*c,S=a*d-h*l,E=u*g-m*f,P=u*y-x*f,A=u*w-p*f,T=m*y-x*g,D=m*w-p*g,B=x*w-p*y;let C=v*B-_*D+M*T+b*A-z*P+S*E;return C?(C=1/C,s[0]=(c*B-l*D+d*T)*C,s[1]=(a*D-n*B-h*T)*C,s[2]=(g*S-y*z+w*b)*C,s[3]=(x*z-m*S-p*b)*C,s[4]=(l*A-o*B-d*P)*C,s[5]=(i*B-a*A+h*P)*C,s[6]=(y*M-f*S-w*_)*C,s[7]=(u*S-x*M+p*_)*C,s[8]=(o*D-c*A+d*E)*C,s[9]=(n*A-i*D-h*E)*C,s[10]=(f*z-g*M+w*v)*C,s[11]=(m*M-u*z-p*v)*C,s[12]=(c*P-o*T-l*E)*C,s[13]=(i*T-n*P+a*E)*C,s[14]=(g*_-f*b-y*v)*C,s[15]=(u*b-m*_+x*v)*C,e):e}static determinant(t){const e=t.m,s=e[0],r=e[1],i=e[2],n=e[3],a=e[4],h=e[5],o=e[6],c=e[7],l=e[8],d=e[9],u=e[10],m=e[11],x=e[12],p=e[13],f=e[14],g=s*h-r*a,y=s*o-i*a,w=r*o-i*h,v=l*p-d*x,_=l*f-u*x,M=d*f-u*p;return c*(s*M-r*_+i*v)-n*(a*M-h*_+o*v)+e[15]*(l*w-d*y+u*g)-m*(x*w-p*y+f*g)}static multiply(t,e,s=void 0){const r=(s=s||new k).m,i=t.m,n=e.m,a=i[0],h=i[1],o=i[2],c=i[3],l=i[4],d=i[5],u=i[6],m=i[7],x=i[8],p=i[9],f=i[10],g=i[11],y=i[12],w=i[13],v=i[14],_=i[15];let M=n[0],b=n[1],z=n[2],S=n[3];return r[0]=M*a+b*l+z*x+S*y,r[1]=M*h+b*d+z*p+S*w,r[2]=M*o+b*u+z*f+S*v,r[3]=M*c+b*m+z*g+S*_,M=n[4],b=n[5],z=n[6],S=n[7],r[4]=M*a+b*l+z*x+S*y,r[5]=M*h+b*d+z*p+S*w,r[6]=M*o+b*u+z*f+S*v,r[7]=M*c+b*m+z*g+S*_,M=n[8],b=n[9],z=n[10],S=n[11],r[8]=M*a+b*l+z*x+S*y,r[9]=M*h+b*d+z*p+S*w,r[10]=M*o+b*u+z*f+S*v,r[11]=M*c+b*m+z*g+S*_,M=n[12],b=n[13],z=n[14],S=n[15],r[12]=M*a+b*l+z*x+S*y,r[13]=M*h+b*d+z*p+S*w,r[14]=M*o+b*u+z*f+S*v,r[15]=M*c+b*m+z*g+S*_,s}static translate(t,e,s=void 0){const r=(s=s||new k).m,i=t.m,n=e.x,a=e.y,h=e.z;let o,c,l,d,u,m,x,p,f,g,y,w;return i===r?(r[12]=i[0]*n+i[4]*a+i[8]*h+i[12],r[13]=i[1]*n+i[5]*a+i[9]*h+i[13],r[14]=i[2]*n+i[6]*a+i[10]*h+i[14],r[15]=i[3]*n+i[7]*a+i[11]*h+i[15]):(o=i[0],c=i[1],l=i[2],d=i[3],u=i[4],m=i[5],x=i[6],p=i[7],f=i[8],g=i[9],y=i[10],w=i[11],r[0]=o,r[1]=c,r[2]=l,r[3]=d,r[4]=u,r[5]=m,r[6]=x,r[7]=p,r[8]=f,r[9]=g,r[10]=y,r[11]=w,r[12]=o*n+u*a+f*h+i[12],r[13]=c*n+m*a+g*h+i[13],r[14]=l*n+x*a+y*h+i[14],r[15]=d*n+p*a+w*h+i[15]),s}static scale(t,e,s=void 0){const r=(s=s||new k).m,i=t.m,n=e.x,a=e.y,h=e.z;return r[0]=i[0]*n,r[1]=i[1]*n,r[2]=i[2]*n,r[3]=i[3]*n,r[4]=i[4]*a,r[5]=i[5]*a,r[6]=i[6]*a,r[7]=i[7]*a,r[8]=i[8]*h,r[9]=i[9]*h,r[10]=i[10]*h,r[11]=i[11]*h,r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15],s}static rotate(t,e,s,r=void 0){const i=(r=r||new k).m,n=t.m;let a,h,o,c,l,d,u,m,x,p,f,g,y,w,v,_,M,b,z,S,E,P,A,T,D=s.x,B=s.y,C=s.z,R=s.length();return R<I||(R=1/R,D*=R,B*=R,C*=R,a=Math.sin(e),h=Math.cos(e),o=1-h,c=n[0],l=n[1],d=n[2],u=n[3],m=n[4],x=n[5],p=n[6],f=n[7],g=n[8],y=n[9],w=n[10],v=n[11],_=D*D*o+h,M=B*D*o+C*a,b=C*D*o-B*a,z=D*B*o-C*a,S=B*B*o+h,E=C*B*o+D*a,P=D*C*o+B*a,A=B*C*o-D*a,T=C*C*o+h,i[0]=c*_+m*M+g*b,i[1]=l*_+x*M+y*b,i[2]=d*_+p*M+w*b,i[3]=u*_+f*M+v*b,i[4]=c*z+m*S+g*E,i[5]=l*z+x*S+y*E,i[6]=d*z+p*S+w*E,i[7]=u*z+f*S+v*E,i[8]=c*P+m*A+g*T,i[9]=l*P+x*A+y*T,i[10]=d*P+p*A+w*T,i[11]=u*P+f*A+v*T,n!==i&&(i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15])),r}static rotateX(t,e,s=void 0){const r=(s=s||new k).m,i=t.m,n=Math.sin(e),a=Math.cos(e),h=i[4],o=i[5],c=i[6],l=i[7],d=i[8],u=i[9],m=i[10],x=i[11];return i!==r&&(r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15]),r[4]=h*a+d*n,r[5]=o*a+u*n,r[6]=c*a+m*n,r[7]=l*a+x*n,r[8]=d*a-h*n,r[9]=u*a-o*n,r[10]=m*a-c*n,r[11]=x*a-l*n,s}static rotateY(t,e,s=void 0){const r=(s=s||new k).m,i=t.m,n=Math.sin(e),a=Math.cos(e),h=i[0],o=i[1],c=i[2],l=i[3],d=i[8],u=i[9],m=i[10],x=i[11];return i!==r&&(r[4]=i[4],r[5]=i[5],r[6]=i[6],r[7]=i[7],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15]),r[0]=h*a-d*n,r[1]=o*a-u*n,r[2]=c*a-m*n,r[3]=l*a-x*n,r[8]=h*n+d*a,r[9]=o*n+u*a,r[10]=c*n+m*a,r[11]=l*n+x*a,s}static rotateZ(t,e,s=void 0){const r=(s=s||new k).m,i=t.m,n=Math.sin(e),a=Math.cos(e),h=i[0],o=i[1],c=i[2],l=i[3],d=i[4],u=i[5],m=i[6],x=i[7];return i!==r&&(r[8]=i[8],r[9]=i[9],r[10]=i[10],r[11]=i[11],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15]),r[0]=h*a+d*n,r[1]=o*a+u*n,r[2]=c*a+m*n,r[3]=l*a+x*n,r[4]=d*a-h*n,r[5]=u*a-o*n,r[6]=m*a-c*n,r[7]=x*a-l*n,s}static fromTranslation(t,e=void 0){return e=e||new k,k.translate(e,t)}static fromRotation(t,e,s=void 0){const r=(s=s||new k).m;let i,n,a,h=e.x,o=e.y,c=e.z,l=e.length();return l<I||(l=1/l,h*=l,o*=l,c*=l,i=Math.sin(t),n=Math.cos(t),a=1-n,r[0]=h*h*a+n,r[1]=o*h*a+c*i,r[2]=c*h*a-o*i,r[3]=0,r[4]=h*o*a-c*i,r[5]=o*o*a+n,r[6]=c*o*a+h*i,r[7]=0,r[8]=h*c*a+o*i,r[9]=o*c*a-h*i,r[10]=c*c*a+n,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1),s}static fromXRotation(t,e=void 0){return k.fromRotation(t,new U(1,0,0),e)}static fromYRotation(t,e=void 0){return k.fromRotation(t,new U(0,1,0),e)}static fromZRotation(t,e=void 0){return k.fromRotation(t,new U(0,0,1),e)}static fromRotationTranslationScale(t,e,s,r=void 0){const i=(r=r||new k).m,n=t.x,a=t.y,h=t.z,o=t.w,c=n+n,l=a+a,d=h+h,u=n*c,m=n*l,x=n*d,p=a*l,f=a*d,g=h*d,y=o*c,w=o*l,v=o*d,_=s.x,M=s.y,b=s.z;return i[0]=(1-(p+g))*_,i[1]=(m+v)*_,i[2]=(x-w)*_,i[3]=0,i[4]=(m-v)*M,i[5]=(1-(u+g))*M,i[6]=(f+y)*M,i[7]=0,i[8]=(x+w)*b,i[9]=(f-y)*b,i[10]=(1-(u+p))*b,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,r}static fromQuat(t,e=void 0){const s=(e=e||new k).m;let r=t.x,i=t.y,n=t.z,a=t.w,h=r+r,o=i+i,c=n+n,l=r*h,d=i*h,u=i*o,m=n*h,x=n*o,p=n*c,f=a*h,g=a*o,y=a*c;return s[0]=1-u-p,s[1]=d+y,s[2]=m-g,s[3]=0,s[4]=d-y,s[5]=1-l-p,s[6]=x+f,s[7]=0,s[8]=m+g,s[9]=x-f,s[10]=1-l-u,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,e}static perspective(t,e,s,r,i=void 0){const n=(i=i||new k).m;let a,h=1/Math.tan(t/2);return n[0]=h/e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=h,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,null!=r&&r!==1/0?(a=1/(s-r),n[10]=(r+s)*a,n[14]=2*r*s*a):(n[10]=-1,n[14]=-2*s),i}static ortho(t,e,s,r,i,n,a=void 0){const h=(a=a||new k).m;let o=1/(t-e),c=1/(s-r),l=1/(i-n);return h[0]=-2*o,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=-2*c,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=2*l,h[11]=0,h[12]=(t+e)*o,h[13]=(r+s)*c,h[14]=(n+i)*l,h[15]=1,a}static lookAt(t,e,s,r=void 0){const i=(r=r||new k).m;let n,a,h,o,c,l,d,u,m,x;const p=t.x,f=t.y,g=t.z,y=s.x,w=s.y,v=s.z,_=e.x,M=e.y,b=e.z;return Math.abs(p-_)<I&&Math.abs(f-M)<I&&Math.abs(g-b)<I?k.identity(r):(d=p-_,u=f-M,m=g-b,x=1/Math.hypot(d,u,m),d*=x,u*=x,m*=x,n=w*m-v*u,a=v*d-y*m,h=y*u-w*d,x=Math.hypot(n,a,h),x?(x=1/x,n*=x,a*=x,h*=x):(n=0,a=0,h=0),o=u*h-m*a,c=m*n-d*h,l=d*a-u*n,x=Math.hypot(o,c,l),x?(x=1/x,o*=x,c*=x,l*=x):(o=0,c=0,l=0),i[0]=n,i[1]=o,i[2]=d,i[3]=0,i[4]=a,i[5]=c,i[6]=u,i[7]=0,i[8]=h,i[9]=l,i[10]=m,i[11]=0,i[12]=-(n*p+a*f+h*g),i[13]=-(o*p+c*f+l*g),i[14]=-(d*p+u*f+m*g),i[15]=1,r)}static add(t,e,s=void 0){const r=(s=s||new k).m,i=t.m,n=e.m;return r[0]=i[0]+n[0],r[1]=i[1]+n[1],r[2]=i[2]+n[2],r[3]=i[3]+n[3],r[4]=i[4]+n[4],r[5]=i[5]+n[5],r[6]=i[6]+n[6],r[7]=i[7]+n[7],r[8]=i[8]+n[8],r[9]=i[9]+n[9],r[10]=i[10]+n[10],r[11]=i[11]+n[11],r[12]=i[12]+n[12],r[13]=i[13]+n[13],r[14]=i[14]+n[14],r[15]=i[15]+n[15],s}static subtract(t,e,s=void 0){const r=(s=s||new k).m,i=t.m,n=e.m;return r[0]=i[0]-n[0],r[1]=i[1]-n[1],r[2]=i[2]-n[2],r[3]=i[3]-n[3],r[4]=i[4]-n[4],r[5]=i[5]-n[5],r[6]=i[6]-n[6],r[7]=i[7]-n[7],r[8]=i[8]-n[8],r[9]=i[9]-n[9],r[10]=i[10]-n[10],r[11]=i[11]-n[11],r[12]=i[12]-n[12],r[13]=i[13]-n[13],r[14]=i[14]-n[14],r[15]=i[15]-n[15],s}static multiplyScalar(t,e,s=void 0){const r=(s=s||new k).m,i=t.m;return r[0]=i[0]*e,r[1]=i[1]*e,r[2]=i[2]*e,r[3]=i[3]*e,r[4]=i[4]*e,r[5]=i[5]*e,r[6]=i[6]*e,r[7]=i[7]*e,r[8]=i[8]*e,r[9]=i[9]*e,r[10]=i[10]*e,r[11]=i[11]*e,r[12]=i[12]*e,r[13]=i[13]*e,r[14]=i[14]*e,r[15]=i[15]*e,s}setValues(t,e,s,r,i,n,a,h,o,c,l,d,u,m,x,p){const f=this.m;return f[0]=t,f[1]=e,f[2]=s,f[3]=r,f[4]=i,f[5]=n,f[6]=a,f[7]=h,f[8]=o,f[9]=c,f[10]=l,f[11]=d,f[12]=u,f[13]=m,f[14]=x,f[15]=p,this}clone(){return k.clone(this)}copy(t){return k.copy(this,t)}}class q{constructor(t=1,s=.01,r=10){e(this,"frustumHeight",1),e(this,"projectionMatrix",new k),e(this,"fov"),e(this,"_near"),e(this,"_far"),e(this,"_aspectRatio"),e(this,"_dirty",!0),this.fov=t,this.frustumHeight=2*Math.tan(.5*this.fov),this._near=s,this._far=r,this._aspectRatio=1,this.dirty=!0}get near(){return this._near}set near(t){t!==this._near&&(this._near=t,this.dirty=!0)}get far(){return this._far}set far(t){t!==this._far&&(this._far=t,this.dirty=!0)}get aspectRatio(){return this._aspectRatio}set aspectRatio(t){t!==this._aspectRatio&&(this._aspectRatio=t,this.dirty=!0)}get dirty(){return this._dirty}set dirty(t){this._dirty!=t&&(this._dirty=t)}get frustumCorner(){this.dirty&&this.updateMatrix();const t=.5*this.frustumHeight,e=t*this._aspectRatio;return new U(e,t,1)}get matrix(){return this.updateMatrix(),this.projectionMatrix}get FOV(){return this.fov}set FOV(t){t!==this.fov&&(this.fov=t,this.frustumHeight=2*Math.tan(.5*this.fov),this.dirty=!0)}setMatrix(t){k.copy(t,this.projectionMatrix),this.dirty=!1}updateMatrix(){this.dirty&&(k.perspective(this.fov,this._aspectRatio,this._near,this._far,this.projectionMatrix),this.dirty=!1)}}class j{constructor(...t){e(this,"m",[1,0,0,0,1,0,0,0,1]),9===t.length&&(this.m=[...t])}static clone(t){return new j(...t.m)}static copy(t,e){return t.m=[...e.m],t}static setValues(t,e,s,r,i,n,a,h,o,c){const l=t.m;return l[0]=e,l[1]=s,l[2]=r,l[3]=i,l[4]=n,l[5]=a,l[6]=h,l[7]=o,l[8]=c,l}static identity(t=void 0){const e=(t=t||new j).m;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,t}static transpose(t,e=void 0){const s=(e=e||new j).m,r=t.m;if(s===r){let t=r[1],e=r[2],i=r[5];s[1]=r[3],s[2]=r[6],s[3]=t,s[5]=r[7],s[6]=e,s[7]=i}else s[0]=r[0],s[1]=r[3],s[2]=r[6],s[3]=r[1],s[4]=r[4],s[5]=r[7],s[6]=r[2],s[7]=r[5],s[8]=r[8];return e}static invert(t,e=void 0){const s=(e=e||new j).m,r=t.m;let i=r[0],n=r[1],a=r[2],h=r[3],o=r[4],c=r[5],l=r[6],d=r[7],u=r[8],m=u*o-c*d,x=-u*h+c*l,p=d*h-o*l,f=i*m+n*x+a*p;return f?(f=1/f,s[0]=m*f,s[1]=(-u*n+a*d)*f,s[2]=(c*n-a*o)*f,s[3]=x*f,s[4]=(u*i-a*l)*f,s[5]=(-c*i+a*h)*f,s[6]=p*f,s[7]=(-d*i+n*l)*f,s[8]=(o*i-n*h)*f,e):e}static determinant(t){const e=t.m;let s=e[0],r=e[1],i=e[2],n=e[3],a=e[4],h=e[5],o=e[6],c=e[7],l=e[8];return s*(l*a-h*c)+r*(-l*n+h*o)+i*(c*n-a*o)}static multiply(t,e,s=void 0){const r=(s=s||new j).m,i=t.m,n=e.m;let a=i[0],h=i[1],o=i[2],c=i[3],l=i[4],d=i[5],u=i[6],m=i[7],x=i[8],p=n[0],f=n[1],g=n[2],y=n[3],w=n[4],v=n[5],_=n[6],M=n[7],b=n[8];return r[0]=p*a+f*c+g*u,r[1]=p*h+f*l+g*m,r[2]=p*o+f*d+g*x,r[3]=y*a+w*c+v*u,r[4]=y*h+w*l+v*m,r[5]=y*o+w*d+v*x,r[6]=_*a+M*c+b*u,r[7]=_*h+M*l+b*m,r[8]=_*o+M*d+b*x,s}static fromQuat(t,e=void 0){const s=(e=e||new j).m,r=t.x,i=t.y,n=t.z,a=t.w,h=r+r,o=i+i,c=n+n,l=r*h,d=i*h,u=i*o,m=n*h,x=n*o,p=n*c,f=a*h,g=a*o,y=a*c;return s[0]=1-u-p,s[3]=d-y,s[6]=m+g,s[1]=d+y,s[4]=1-l-p,s[7]=x-f,s[2]=m-g,s[5]=x+f,s[8]=1-l-u,e}static add(t,e,s=void 0){const r=(s=s||new j).m,i=t.m,n=e.m;return r[0]=i[0]+n[0],r[1]=i[1]+n[1],r[2]=i[2]+n[2],r[3]=i[3]+n[3],r[4]=i[4]+n[4],r[5]=i[5]+n[5],r[6]=i[6]+n[6],r[7]=i[7]+n[7],r[8]=i[8]+n[8],s}static subtract(t,e,s=void 0){const r=(s=s||new j).m,i=t.m,n=e.m;return r[0]=i[0]-n[0],r[1]=i[1]-n[1],r[2]=i[2]-n[2],r[3]=i[3]-n[3],r[4]=i[4]-n[4],r[5]=i[5]-n[5],r[6]=i[6]-n[6],r[7]=i[7]-n[7],r[8]=i[8]-n[8],s}static multiplyScalar(t,e,s=void 0){const r=(s=s||new j).m,i=t.m;return r[0]=i[0]*e,r[1]=i[1]*e,r[2]=i[2]*e,r[3]=i[3]*e,r[4]=i[4]*e,r[5]=i[5]*e,r[6]=i[6]*e,r[7]=i[7]*e,r[8]=i[8]*e,s}static normalFromMat4(t,e=void 0){const s=(e=e||new j).m,r=t.m,i=r[0],n=r[1],a=r[2],h=r[3],o=r[4],c=r[5],l=r[6],d=r[7],u=r[8],m=r[9],x=r[10],p=r[11],f=r[12],g=r[13],y=r[14],w=r[15],v=i*c-n*o,_=i*l-a*o,M=i*d-h*o,b=n*l-a*c,z=n*d-h*c,S=a*d-h*l,E=u*g-m*f,P=u*y-x*f,A=u*w-p*f,T=m*y-x*g,D=m*w-p*g,B=x*w-p*y;let C=v*B-_*D+M*T+b*A-z*P+S*E;return C?(C=1/C,s[0]=(c*B-l*D+d*T)*C,s[1]=(l*A-o*B-d*P)*C,s[2]=(o*D-c*A+d*E)*C,s[3]=(a*D-n*B-h*T)*C,s[4]=(i*B-a*A+h*P)*C,s[5]=(n*A-i*D-h*E)*C,s[6]=(g*S-y*z+w*b)*C,s[7]=(y*M-f*S-w*_)*C,s[8]=(f*z-g*M+w*v)*C,e):null}static fromMat4(t,e=void 0){const s=(e=e||new j).m,r=t.m;return s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[4],s[4]=r[5],s[5]=r[6],s[6]=r[8],s[7]=r[9],s[8]=r[10],e}clone(){return j.clone(this)}}const N=class t{constructor(t=0,s=0,r=0,i=1){e(this,"x"),e(this,"y"),e(this,"z"),e(this,"w"),this.x=t,this.y=s,this.z=r,this.w=i}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w}static lerp(e,s,r){const i=e.x,n=e.y,a=e.z,h=e.w,o=new t;return o.x=i+r*(s.x-i),o.y=n+r*(s.y-n),o.z=a+r*(s.z-a),o.w=h+r*(s.w-h),o}static closestSlerp(e,s,r){return e.dot(s)<0?t.slerp(e,t.invert(s),r):t.slerp(e,s,r)}static lookAt(e,s,r){const i=e.clone().sub(s).normalize(),n=U.cross(r,i).normalize(),a=U.cross(i,n).normalize(),h=new j(n.x,n.y,n.z,a.x,a.y,a.z,i.x,i.y,i.z);return t.fromMat3(h)}static createFromAxisAngle(e,s){const r=.5*s,i=Math.sin(r);return new t(e.x*i,e.y*i,e.z*i,Math.cos(r))}static getAxisAngle(e){const s=2*Math.acos(e.w),r=Math.sin(s/2),i=new U;return r>t.EPSILON?(i.x=e.x/r,i.y=e.y/r,i.z=e.z/r):(i.x=1,i.y=0,i.z=0),i}static getAngle(e,s){const r=t.dot(e,s);return Math.acos(2*r*r-1)}static multiply(e,s){const r=e.x,i=e.y,n=e.z,a=e.w,h=s.x,o=s.y,c=s.z,l=s.w,d=new t;return d.x=r*l+a*h+i*c-n*o,d.y=i*l+a*o+n*h-r*c,d.z=n*l+a*c+r*o-i*h,d.w=a*l-r*h-i*o-n*c,d}static calculateW(e){const s=e.x,r=e.y,i=e.z,n=new t;return n.x=s,n.y=r,n.z=i,n.w=Math.sqrt(Math.abs(1-s*s-r*r-i*i)),n}static exp(e){const s=e.x,r=e.y,i=e.z,n=e.w,a=Math.sqrt(s*s+r*r+i*i),h=Math.exp(n),o=a>0?h*Math.sin(a)/a:0,c=new t;return c.x=s*o,c.y=r*o,c.z=i*o,c.w=h*Math.cos(a),c}static ln(e){const s=e.x,r=e.y,i=e.z,n=e.w,a=Math.sqrt(s*s+r*r+i*i),h=a>0?Math.atan2(a,n)/a:0,o=new t;return o.x=s*h,o.y=r*h,o.z=i*h,o.w=.5*Math.log(s*s+r*r+i*i+n*n),o}static scale(e,s){return new t(e.x*s,e.y*s,e.z*s,e.w*s)}static pow(e,s){let r=t.ln(e);return r=t.scale(r,s),t.exp(r)}static slerp(e,s,r){const i=e.x,n=e.y,a=e.z,h=e.w;let o,c,l,d,u,m=s.x,x=s.y,p=s.z,f=s.w;c=i*m+n*x+a*p+h*f,c<0&&(c=-c,m=-m,x=-x,p=-p,f=-f),1-c>t.EPSILON?(o=Math.acos(c),l=Math.sin(o),d=Math.sin((1-r)*o)/l,u=Math.sin(r*o)/l):(d=1-r,u=r);const g=new t;return g.x=d*i+u*m,g.y=d*n+u*x,g.z=d*a+u*p,g.w=d*h+u*f,g}static random(){let e=Math.random(),s=Math.random(),r=Math.random(),i=Math.sqrt(1-e),n=Math.sqrt(e);const a=new t;return a.x=i*Math.sin(2*Math.PI*s),a.y=i*Math.cos(2*Math.PI*s),a.z=n*Math.sin(2*Math.PI*r),a.w=n*Math.cos(2*Math.PI*r),a}static invert(e){const s=e.x,r=e.y,i=e.z,n=e.w,a=s*s+r*r+i*i+n*n,h=a?1/a:0,o=new t;return o.x=-s*h,o.y=-r*h,o.z=-i*h,o.w=n*h,o}static conjugate(e){const s=new t;return s.x=-e.x,s.y=-e.y,s.z=-e.z,s.w=e.w,s}static fromMat3(e){const s=e.m,r=s[0]+s[4]+s[8];let i;const n=new t;if(r>0)i=Math.sqrt(r+1),n.w=.5*i,i=.5/i,n.x=(s[5]-s[7])*i,n.y=(s[6]-s[2])*i,n.z=(s[1]-s[3])*i;else{let t=0;s[4]>s[0]&&(t=1),s[8]>s[3*t+t]&&(t=2);const e=(t+1)%3,r=(t+2)%3;i=Math.sqrt(s[3*t+t]-s[3*e+e]-s[3*r+r]+1);const a=.5*i,h=.5/i;n.w=(s[3*e+r]-s[3*r+e])*h;const o=(s[3*e+t]+s[3*t+e])*h,c=(s[3*r+t]+s[3*t+r])*h;n.x=0==t?a:0==e?o:c,n.y=1==t?a:1==e?o:c,n.z=2==t?a:2==e?o:c}return n}static fromEuler(e,s,r){return(new t).rotateEulerValues(e,s,r)}clone(){return new t(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}setValues(t,e,s,r){return this.x=t,this.y=e,this.z=s,this.w=r,this}dot(e){return t.dot(this,e)}identity(){return this.x=0,this.y=0,this.z=0,this.w=1,this}multiply(t){const e=this.x,s=this.y,r=this.z,i=this.w,n=t.x,a=t.y,h=t.z,o=t.w;return this.x=e*o+i*n+s*h-r*a,this.y=s*o+i*a+r*n-e*h,this.z=r*o+i*h+e*a-s*n,this.w=i*o-e*n-s*a-r*h,this}invert(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=this.w,this}rotateEulerValues(t,e,s){return this.rotateY(e),this.rotateX(t),this.rotateZ(s),this}rotateX(t){t*=.5;const e=this.x,s=this.y,r=this.z,i=this.w,n=Math.sin(t),a=Math.cos(t);return this.x=e*a+i*n,this.y=s*a+r*n,this.z=r*a-s*n,this.w=i*a-e*n,this}rotateY(t){t*=.5;const e=this.x,s=this.y,r=this.z,i=this.w,n=Math.sin(t),a=Math.cos(t);return this.x=e*a-r*n,this.y=s*a+i*n,this.z=r*a+e*n,this.w=i*a-s*n,this}rotateZ(t){t*=.5;const e=this.x,s=this.y,r=this.z,i=this.w,n=Math.sin(t),a=Math.cos(t);return this.x=e*a+s*n,this.y=s*a-e*n,this.z=r*a+i*n,this.w=i*a-r*n,this}setAxisAngle(t,e){e*=.5;const s=Math.sin(e);return this.x=s*t.x,this.y=s*t.y,this.z=s*t.z,this.w=Math.cos(e),this}rotateAxisAngle(e,s){const r=t.createFromAxisAngle(e,s),i=r.x,n=r.y,a=r.z,h=r.w,o=this.x,c=this.y,l=this.z,d=this.w;return this.x=i*d+h*o+n*l-a*c,this.y=n*d+h*c+a*o-i*l,this.z=a*d+h*l+i*c-n*o,this.w=h*d-i*o-n*c-a*l,this}lookAt(t,e,s){const r=t.clone();r.sub(e),r.normalize();const i=U.cross(s,r);i.normalize();const n=U.cross(r,i);n.normalize();const a=new j(i.x,i.y,i.z,n.x,n.y,n.z,r.x,r.y,r.z);return this.fromMat3(a)}fromMat3(t){const e=t.m,s=e[0]+e[4]+e[8];let r;if(s>0)r=Math.sqrt(s+1),this.w=.5*r,r=.5/r,this.x=(e[5]-e[7])*r,this.y=(e[6]-e[2])*r,this.z=(e[1]-e[3])*r;else{let t=0;e[4]>e[0]&&(t=1),e[8]>e[3*t+t]&&(t=2);const s=(t+1)%3,i=(t+2)%3;r=Math.sqrt(e[3*t+t]-e[3*s+s]-e[3*i+i]+1);const n=.5*r,a=.5/r;this.w=(e[3*s+i]-e[3*i+s])*a;const h=(e[3*s+t]+e[3*t+s])*a,o=(e[3*i+t]+e[3*t+i])*a;this.x=0==t?n:0==s?h:o,this.y=1==t?n:1==s?h:o,this.z=2==t?n:2==s?h:o}return this}normalize(){let t=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;return t>0&&(t=1/Math.sqrt(t)),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}};e(N,"IDENTITY",new N),e(N,"ZERO",new N(0,0,0,0)),e(N,"EPSILON",1e-9);let X=N;class W{constructor(){e(this,"name",""),e(this,"id",-1),e(this,"_rotation",new X),e(this,"_position",new U),e(this,"_scale",new U(1,1,1)),e(this,"_matrix",new k),e(this,"_localMatrix",new k),e(this,"_parent",null),e(this,"_children",[]),e(this,"_signalDirtyDown",!0),e(this,"_dirty",!0)}get dirty(){return this._dirty}get rotation(){return this._rotation.clone()}set rotation(t){this._rotation.copy(t),this.setDirty()}get position(){return this._position.clone()}set position(t){this._position.copy(t),this.setDirty()}get scale(){return this._scale.clone()}set scale(t){this._scale.copy(t),this.setDirty()}get localMatrix(){return this.updateMatrix(),this._localMatrix}get parent(){return this._parent}set parent(t){this._parent!==t&&(this._parent&&this._parent.removeChild(this),this._parent=t,t&&t.addChild(this),this.setDirty())}get children(){return this._children}get flipped(){let t=Math.sign(this.scale.x)*Math.sign(this.scale.y)*Math.sign(this.scale.z);return this.parent?this.parent.flipped*t:t}get worldMatrix(){return this.updateMatrix(),this._matrix}get worldPosition(){return this.updateMatrix(),(new U).transform(this._matrix)}set worldPosition(t){this.parent?this.position=t.clone().transform(k.invert(this.parent.worldMatrix)):this.position=t}set scaleScalar(t){this._scale.setValues(t,t,t),this.setDirty()}get worldRotation(){let t=this._rotation;return this._parent&&(t=X.multiply(this._parent.worldRotation,t)),t}set worldRotation(t){this.parent?this.rotation=X.invert(this.parent.worldRotation).multiply(t.clone()):this.rotation=t}get rotationMatrixMat4(){return k.fromQuat(this._rotation)}get worldRotationMatrixMat4(){return k.fromQuat(this.worldRotation)}get rotationMatrixMat3(){return j.fromQuat(this._rotation)}set rotationMatrixMat3(t){this._rotation.fromMat3(t),this.setDirty()}get worldRotationMatrixMat3(){return j.fromQuat(this.worldRotation)}set eulerX(t){this._rotation.identity(),this.rotateX(t)}set eulerY(t){this._rotation.identity(),this.rotateY(t)}set eulerZ(t){this._rotation.identity(),this.rotateZ(t)}set eulerXY(t){this.setEulerValues(t.x,t.y,0)}get euler(){return W.getEulerYXZ(j.fromQuat(this._rotation))}set euler(t){this._rotation.identity(),this.rotateEulerValues(t.x,t.y,t.z)}get forward(){const t=this.rotationMatrixMat3.m;return new U(t[6],t[7],t[8])}get worldForward(){const t=this.worldRotationMatrixMat3.m;return new U(t[6],t[7],t[8])}get right(){const t=this.rotationMatrixMat3.m;return new U(t[0],t[1],t[2])}get worldRight(){const t=this.worldRotationMatrixMat3.m;return new U(t[0],t[1],t[2])}get up(){const t=this.rotationMatrixMat3.m;return new U(t[3],t[4],t[5])}get worldUp(){const t=this.worldRotationMatrixMat3.m;return new U(t[3],t[4],t[5])}get direction(){return new U(0,0,1).transformMat3(this.worldRotationMatrixMat3)}static getEulerYXZ(t){const e=t.m;let s,r,i;return e[7]<-.9999?(s=Math.PI/2,r=Math.atan2(e[3],e[0]),i=0):e[7]>.9999?(s=-Math.PI/2,r=-Math.atan2(e[3],e[0]),i=0):(s=Math.asin(-e[7]),r=Math.atan2(e[6],e[8]),i=Math.atan2(e[1],e[4])),new U(s,r,i)}identity(){this._position.setValues(0,0,0),this._rotation.identity(),this._scale.setValues(1,1,1)}addChild(t){this._children.indexOf(t)<0&&(this._children.push(t),t.parent=this)}removeChild(t){const e=this._children.indexOf(t);e>-1&&(this._children.splice(e,1),t.parent=null)}getChildrenRecursive(){const t=[...this._children];return this._children.forEach((e=>t.push(...e.getChildrenRecursive()))),t}setDirty(){this._dirty||(this._dirty=!0,this.signalDirtyDown())}clone(){return(new W).copy(this)}copy(t){return this._scale.copy(t._scale),this._rotation.copy(t._rotation),this._position.copy(t._position),this._dirty=!0,this}lookAt(t,e,s=U.UP){this.position=t,this.lookAtFromCurrentPos(e,s)}lookAtFromCurrentPos(t,e=U.UP){this._rotation=X.lookAt(this._position,t,e),this.setDirty()}setPositionRotationScale(t,e,s){this._position.copy(t),this._rotation.copy(e),this._scale.copy(s),this.setDirty()}setPositionValues(t,e,s){this._position.setValues(t,e,s),this.setDirty()}setScaleValues(t,e,s){this._scale.setValues(t,e,s),this.setDirty()}translateX(t){this._position.x+=t,this.setDirty()}translateY(t){this._position.y+=t,this.setDirty()}translateZ(t){this._position.z+=t,this.setDirty()}translate(t){this._position.add(t),this.setDirty()}translateValues(t,e,s){this._position.x+=t,this._position.y+=e,this._position.z+=s,this.setDirty()}rotateEulerValues(t,e,s){return this._rotation.rotateEulerValues(t,e,s),this.setDirty(),this._rotation}rotateEuler(t){return this.rotateEulerValues(t.x,t.y,t.z)}setEulerValues(t,e,s){return this._rotation.identity(),this.rotateEulerValues(t,e,s)}rotateAxisAngle(t,e){return this._rotation.rotateAxisAngle(t,e),this.setDirty(),this._rotation}rotateX(t){this._rotation.rotateX(t),this.setDirty()}rotateY(t){this._rotation.rotateY(t),this.setDirty()}rotateZ(t){this._rotation.rotateZ(t),this.setDirty()}setDirection(t,e){const s=U.cross(e,t);s.normalize();const r=U.cross(t,s);r.normalize(),this.rotationMatrixMat3=new j(s.x,s.y,s.z,r.x,r.y,r.z,t.x,t.y,t.z)}setParentDirty(){this.signalDirtyDown()}updateMatrix(){return!(!this._dirty&&!this._signalDirtyDown)&&(this._dirty&&k.fromRotationTranslationScale(this._rotation,this._position,this._scale,this._localMatrix),this._parent?k.multiply(this._parent.worldMatrix,this._localMatrix,this._matrix):this._dirty&&k.copy(this._localMatrix,this._matrix),this._dirty=!1,this._signalDirtyDown=!1,!0)}signalDirtyDown(){this._signalDirtyDown||(this._signalDirtyDown=!0,this._children.forEach((t=>t.setParentDirty())))}}class G extends W{constructor(t=1,s=.01,r=10){super(),e(this,"projection"),e(this,"_viewProjection",new k),e(this,"_viewMatrix",new k),this.projection=new q(t,s,r)}get view(){return this}get viewProjection(){return this.updateMatrix(),this._viewProjection}get projectionMatrix(){return this.projection.matrix}get viewMatrix(){return this.updateMatrix(),this._viewMatrix}get matrix(){return this.viewMatrix}get worldRotationMatrix(){return k.invert(this.worldRotationMatrixMat4)}worldToScreenPoint(t){const e=new F(t.x,t.y,t.z,1);return e.transform(this.viewProjection),e.x/=e.w,e.y/=e.w,e.x=.5*e.x+.5,e.y=-.5*e.y+.5,e}screenToWorldPoint(t){const e=2*t.x-1,s=-2*t.y+1;return new U(e,s,1).transform(k.invert(this.viewProjection))}getDepth(t){return new F(t.x,t.y,t.z,1).transform(this.viewProjection).z}updateMatrix(){if(super.updateMatrix()||this.projection.dirty){const t=this.projection.matrix;return k.invert(this.worldMatrix,this._viewMatrix),k.multiply(t,this._viewMatrix,this._viewProjection),!0}return!1}}class Y{constructor(){e(this,"model",new W),e(this,"zPos",2),e(this,"progress",0),e(this,"parent",new W),e(this,"rotParent",new W),e(this,"startProgress",0),e(this,"endProgress",0)}reset(t,e,r,n,a){this.zPos=e,this.parent.copy(r),this.rotParent.parent=this.parent,a=i(a,0,2.5);const h=s(-1,1,.618033988749895*e%1)*a*.1;this.parent.position=this.parent.position.add(this.parent.right.multiplyScalar(h)),this.startProgress=s(.1,.25,Math.random()),this.endProgress=s(.35,.975,Math.random());let o=1+Math.random();const c=new U(2,1,0).multiplyScalar(.01/o),l=n[this.endProgress*(n.length-1)|0],d=new U(l.x,l.y,l.z).add((new U).randomize().multiply(c));this.model.scaleScalar=o,this.model.position=d.multiplyScalar(-o),this.model.parent=this.rotParent;this.rotParent.setEulerValues(-.85,0,2.3999632297286535*e),this.update(t)}update(t){let e=Math.max(0,this.zPos-t)/4;this.progress=r(s(this.startProgress,this.endProgress,Math.pow(Math.max(0,1.065-e),.25)))}}class H{constructor(t,s,r,i,n,a){e(this,"data",null),e(this,"name"),e(this,"stride"),e(this,"storeData"),e(this,"buffer",null),e(this,"vertexCount",-1),e(this,"_renderer"),this._renderer=t,this.stride=i,this.name=s,this.storeData=n,this.vertexCount=r.length/i,a?(this.buffer=this._renderer.context.createBuffer(),this.setData(r,n)):this.data=r}setData(t,e){if(e||!this.buffer?this.data=t:this.data=null,0!==t.length){if(this.buffer){const e=this._renderer.context;e.bindBuffer(m,this.buffer),e.bufferData(m,t.byteLength,y),e.bufferSubData(m,0,t)}}else l.warn("VertexAttribute: no data: probably a mesh file could not be loaded: "+this.name)}destruct(){if(this.buffer){this._renderer.context.deleteBuffer(this.buffer)}this.data=null}}const Z={name:"aPos",stride:3},$={name:"aUV0",stride:2},Q={name:"aUV1",stride:2},J={name:"aNormal",stride:3},K={name:"aColor0",stride:3},tt={name:"aColor1",stride:3},et={name:"aTangent",stride:4};let st=0;class rt{constructor(t,s=!0,r=!1){e(this,"name",""),e(this,"id"),e(this,"animatorId",-1),e(this,"indexBuffer"),e(this,"interleaved"),e(this,"interleavedBuffer"),e(this,"interleavedStrideSum",0),e(this,"isDynamic"),e(this,"indices"),e(this,"attributes",[]),e(this,"renderer"),e(this,"indexType",w),e(this,"vertexCount",0),e(this,"dirty",!0),this.renderer=t,this.vertexCount=0,this.id=st++,this.interleaved=s,this.isDynamic=r}setJSONData(t,e=!1){this.animatorId=t.animatorId,this.isDynamic=t.isDynamic||!1,t.indices&&t.indices.length>0&&(t.use32BitIndices?this.setIndices32(new Uint32Array(t.indices)):this.setIndices(new Uint16Array(t.indices))),t.attributes.forEach((t=>{this.setAttribute(t.name,t.stride,new Float32Array(t.data),e)}))}clone(){const t=new rt(this.renderer,this.interleaved,this.isDynamic);return this.attributes.forEach((e=>{t.attributes.push(e)})),t.vertexCount=this.vertexCount,t}interleaveData(){if(!this.dirty||!this.interleaved)return;this.interleavedStrideSum=0,this.attributes.forEach((t=>{this.interleavedStrideSum+=t.stride}));const t=new Float32Array(this.interleavedStrideSum*this.vertexCount);let e=0;for(let r=0;r<this.vertexCount;r++)this.attributes.forEach((s=>{for(let i=0;i<s.stride;i++)t[e++]=s.data[r*s.stride+i]}));this.attributes.forEach((t=>{t.storeData||(t.data=null)})),this.interleavedBuffer=this.renderer.context.createBuffer();const s=this.renderer.context;s.bindBuffer(m,this.interleavedBuffer),s.bufferData(m,t,y),this.dirty=!1}isInterleaved(){return this.interleaved}hasIndices(){return!!this.indices}setAttribute(t,e,s,r=!1){this.setData(s,t,e,r)}setPositions(t,e=!1){const s=Z;this.setData(t,s.name,s.stride,e)}getPositions(){return this.getData(Z.name)}setNormals(t,e=!1){const s=J;this.setData(t,s.name,s.stride,e)}getNormals(){return this.getData(J.name)}setColors(t){const e=K;this.setData(t,e.name,e.stride)}getColors(){return this.getData(K.name)}setColors1(t){const e=tt;this.setData(t,e.name,e.stride)}getColors1(){return this.getData(tt.name)}setUV0(t,e=!1){const s=$;this.setData(t,s.name,s.stride,e)}getUV0(){return this.getData($.name)}setUV1(t,e=!1){const s=Q;this.setData(t,s.name,s.stride,e)}getUV1(){return this.getData(Q.name)}setTangents(t,e=!1){const s=et;this.setData(t,s.name,s.stride,e)}getTangents(){return this.getData(et.name)}setData(t,e,s,r=!1){const i=this.getAttributeIndex(e),n=t.length/s;if(i<0)this.attributes.push(new H(this.renderer,e,t,s,r,!this.interleaved));else{const a=this.attributes[i];a.vertexCount==n?a.setData(t,r):(a.destruct(),this.attributes[i]=new H(this.renderer,e,t,s,r,!this.interleaved))}this.vertexCount=n,this.interleaved&&(this.dirty=!0)}deleteAttribute(t){const e=this.getAttributeIndex(t);e>=0&&this.attributes.splice(e,1),this.dirty=!0}hasAttribute(t){return this.getAttributeIndex(t)>=0}getAttribute(t){const e=this.getAttributeIndex(t);if(e>=0)return this.attributes[e]}getData(t){const e=this.getAttribute(t);return e&&e.data?e.data:void l.log("Mesh: getData",t,"no data")}setIndices(t){if(!(t instanceof Uint16Array))throw"Indices need to be of type Uint16Array";this.indexType=w,this.indices=t;const e=this.renderer.context;this.indexBuffer||(this.indexBuffer=e.createBuffer()),e.bindBuffer(x,this.indexBuffer),e.bufferData(x,this.indices,y)}setIndices32(t){if(!(t instanceof Uint32Array))throw"Indices need to be of type Uint32Array";if(this.renderer.extensions.element_index_uint||this.renderer.context instanceof WebGL2RenderingContext){this.indexType=5125,this.indices=t;const e=this.renderer.context;this.indexBuffer||(this.indexBuffer=e.createBuffer()),e.bindBuffer(x,this.indexBuffer),e.bufferData(x,this.indices,y)}else l.log("mesh: setIndices32: extension not supported: element_index_uint: using 16 bits indices"),this.setIndices(new Uint16Array(t))}isSkinned(){return this.hasAttribute("aSkinIndex")}destruct(){this.renderer.destructVAO(this);const t=this.renderer.context;this.interleavedBuffer&&t.deleteBuffer(this.interleavedBuffer),this.indexBuffer&&t.deleteBuffer(this.indexBuffer),this.attributes.forEach((t=>{t.destruct()}))}getAttributeIndex(t){return this.attributes.findIndex((e=>e.name===t))}}function it(t,e){const s=new rt(t);return s.setData(function(t){const e=t.length,s=new Float32Array(4*e);let r=0;return t.forEach((t=>{s[r++]=t.x,s[r++]=t.y,s[r++]=t.z,s[r++]=t.w})),s}(e),"aData",4),s}let nt,at,ht;class ot{constructor(){e(this,"time"),e(this,"dt"),e(this,"fps"),e(this,"avgFps",60),e(this,"minFps",1e10),e(this,"maxFps",0),this.fps=60,this.dt=1/this.fps,this.time=0}static get instance(){return nt||(nt=new ot),nt}static timePerformance(t,e="timer"){console.time(e),t(),console.timeEnd(e)}update(t){t*=.001,this.dt=i(t-this.time,1/240,1/30),this.time=t,this.fps=1/this.dt,this.minFps=Math.min(this.minFps,this.fps),this.maxFps=Math.max(this.maxFps,this.fps),this.avgFps>0?this.avgFps=s(this.fps,this.avgFps,.95):this.avgFps=1/60}}class ct extends F{static get ONE(){return new ct(1,1,1,1)}static get ZERO(){return new ct(0,0,0,0)}static get random(){return new ct(Math.random(),Math.random(),Math.random())}get r(){return this.x}set r(t){this.x=t}get g(){return this.y}set g(t){this.y=t}get b(){return this.z}set b(t){this.z=t}get a(){return this.w}set a(t){this.w=t}get vector3(){return new U(this.x,this.y,this.z)}get gammaToLinearSpace(){return ct.multiply(this,ct.multiply(this,ct.multiplyScalar(this,.305306011).addScalar(.682171111)).addScalar(.012522878))}get linearToGammaSpace(){const t=ct.max(this,ct.ZERO);return ct.max(t.powScalar(.416666667).multiplyScalar(1.055).addScalar(-.055),ct.ZERO)}static fromHex(t){return(new ct).setHex(t)}static fromRGB255(t){return(new ct).setRGBA255([...t,1])}static fromHSV(t,e,s){return(new ct).setHSV(t,e,s)}clone(){return new ct(this.x,this.y,this.z,this.w)}setRGBA255(t){return this.r=t[0]/255,this.g=t[1]/255,this.b=t[2]/255,this.a=t[3],this}setHex(t){t=t.replace(/[^0-9A-F]/gi,"");const e=parseInt(t,16);return this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this.a=1,this}getHex(){function t(t){const e=t.toString(16);return 1==e.length?"0"+e:e}return`#${t(255*this.r|0)}${t(255*this.g|0)}${t(255*this.b|0)}`}setHSV(t,e,s){let r=0,i=0,n=0;const a=Math.floor(6*t),h=6*t-a,o=s*(1-e),c=s*(1-h*e),l=s*(1-(1-h)*e);switch(a%6){case 0:r=s,i=l,n=o;break;case 1:r=c,i=s,n=o;break;case 2:r=o,i=s,n=l;break;case 3:r=o,i=c,n=s;break;case 4:r=l,i=o,n=s;break;case 5:r=s,i=o,n=c}return this.r=r,this.g=i,this.b=n,this}}class lt{constructor(t){e(this,"enabledAttribArrays",[]),e(this,"material",null),e(this,"mesh",null),e(this,"renderer"),e(this,"program",null),e(this,"depthMask",!0),e(this,"depthTest",!0),e(this,"alphaToCoverage",!1),e(this,"depthFunc",-1),e(this,"culling",-1),e(this,"cullingEnabled",!0),e(this,"blendEquation",-1),e(this,"blendEnabled",!0),e(this,"sourceBlend",-1),e(this,"destinationBlend",-1),e(this,"textureSlots",[]),e(this,"activeTextureSlot",-1),this.renderer=t,this.setBlendEnabled(!this.blendEnabled),this.setCullingEnabled(!this.cullingEnabled),this.setDepthMask(!this.depthMask),this.setDepthTest(!this.depthTest)}bindTextureToSlot(t,e=0){this.textureSlots[e]!=t.textureGL&&(this.activateSlot(e),this.renderer.context.bindTexture(t.target,t.textureGL),this.textureSlots[e]=t.textureGL)}activateSlot(t=0){this.activeTextureSlot!=t&&(this.activeTextureSlot=t,this.renderer.context.activeTexture(33984+t))}unBindTextureFromSlot(t,e=0){this.textureSlots[e]==t&&(this.activateSlot(e),this.renderer.context.bindTexture(3553,null),this.textureSlots[e]=null)}setProgram(t){return t!=this.program&&(this.program=t,this.renderer.context.useProgram(this.program),!0)}setDepthMask(t){t!=this.depthMask&&(this.renderer.context.depthMask(t),this.depthMask=t)}getDepthMask(){return this.depthMask}setAlphaToCoverage(t){t!=this.alphaToCoverage&&(t?this.renderer.context.enable(32926):this.renderer.context.disable(32926),this.alphaToCoverage=t)}setDepthTest(t){t!=this.depthTest&&(t?this.renderer.context.enable(2929):this.renderer.context.disable(2929),this.depthTest=t)}setDepthFunc(t){t!=this.depthFunc&&(this.renderer.context.depthFunc(t),this.depthFunc=t)}setCullingEnabled(t){t!=this.cullingEnabled&&(t?this.renderer.context.enable(2884):this.renderer.context.disable(2884),this.cullingEnabled=t)}setCulling(t){t!=this.culling&&(0==t?this.setCullingEnabled(!1):(this.setCullingEnabled(!0),this.renderer.context.cullFace(t)),this.culling=t)}setBlendEquation(t){t!=this.blendEquation&&(this.renderer.context.blendEquation(t),this.blendEquation=t)}setBlendEnabled(t){t!=this.blendEnabled&&(t?this.renderer.context.enable(3042):this.renderer.context.disable(3042),this.blendEnabled=t)}setBlendFunc(t,e){t==this.sourceBlend&&e==this.destinationBlend||(this.renderer.context.blendFunc(t,e),this.sourceBlend=t,this.destinationBlend=e)}setBlendFuncSeparate(t,e,s,r){this.renderer.context.blendFuncSeparate(t,e,s,r),this.sourceBlend=-1}}function dt(t,e){const s=t.getExtension(e);return s?l.log("enabled extension "+e):l.log("extension "+e+" is not supported"),s}const ut=[],mt=[],xt=[],pt=[],ft=[],gt=[],yt=new d,wt=new d,vt=new d;let _t=!1,Mt=!1;function bt(t){if(ht&&ht.getBoundingClientRect){const e=ht.getBoundingClientRect();yt.x=(t.clientX-e.left)/e.width,yt.y=(t.clientY-e.top)/e.height}else yt.setValues(t.clientX,t.clientY)}function zt(){mt.forEach((t=>t()))}function St(t){const e=Math.sign(-t.deltaY);ut.forEach((t=>t(e)))}function Et(t){bt(t),_t=Mt=!0,xt.forEach((t=>t(yt.clone())))}function Pt(t){bt(t),ft.forEach((t=>t(yt.clone())))}function At(){_t=Mt=!1,pt.forEach((t=>t()))}class Tt{constructor(t,s){var r;e(this,"_updateRequest"),e(this,"_manualUpdate",!1),at=t,ht=s,at&&((r=t).addEventListener("click",zt),r.addEventListener("mousedown",Et),r.addEventListener("mousemove",Pt),r.addEventListener("mouseup",At),r.addEventListener("mousecancel",At),r.addEventListener("mouseout",At),r.addEventListener("wheel",St)),this.updateLoop()}get normalizedPos(){return yt.clone()}get screenPos(){return new d(2*yt.x-1,1-2*yt.y)}get normalizedVelocity(){return vt.clone()}get mouseDown(){return _t}get mouseDownThisFrame(){return Mt}addWheelEvent(t){ut.push(t)}addClickEvent(t){mt.push(t)}addDownEvent(t){xt.push(t)}addMoveEvent(t){ft.push(t)}addUpEvent(t){pt.push(t)}addDragEvent(t){gt.push(t)}updateManual(){this._manualUpdate=!0,this.update()}destruct(){var t;at&&((t=at).removeEventListener("click",zt),t.removeEventListener("mousedown",Et),t.removeEventListener("mousemove",Pt),t.removeEventListener("mouseup",At),t.removeEventListener("mousecancel",At),t.removeEventListener("mouseout",At),t.removeEventListener("wheel",St)),cancelAnimationFrame(this._updateRequest)}updateLoop(){this._manualUpdate||(this.update(),this._updateRequest=requestAnimationFrame((()=>this.updateLoop())))}update(){vt.copy(yt).subtract(wt),wt.copy(yt),this.mouseDown&&vt.length()>0&&gt.forEach((t=>t(vt)))}}const Dt={alpha:!1,antialias:!0,depth:!0,failIfMajorPerformanceCaveat:!1,powerPreference:"high-performance",premultipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!0};let Bt,Ct=0;class Rt{constructor(t,s,r={}){e(this,"id",0),e(this,"context"),e(this,"maxParams"),e(this,"renderState"),e(this,"extensions"),e(this,"isWebgl2",!1),e(this,"canvas"),e(this,"options"),e(this,"_clearColor",new ct(.5,.5,.5,1)),e(this,"_size",new d),e(this,"_mouseListener"),e(this,"_fb",[]),e(this,"blitMat"),e(this,"blitMesh"),e(this,"_rt",null),this.options={...Dt,...r},this.id=Ct++,this.canvas=t;const i=this.canvas.getContext(s,this.options);if(!i)throw new Error("could not get a 3d context: aborting");var n;this.context=i,this.isWebgl2=this.context instanceof WebGL2RenderingContext,this.extensions=function(t){const e=t.context,s=t.isWebgl2;let r;return{color_buffer_float:dt(e,"EXT_color_buffer_float")||dt(e,"WEBGL_color_buffer_float"),color_buffer_half_float:dt(e,"EXT_color_buffer_half_float"),texture_float:s||dt(e,"OES_texture_float"),texture_float_linear:dt(e,"OES_texture_float_linear"),texture_half_float:s||dt(e,"OES_texture_half_float"),texture_half_float_linear:s||dt(e,"OES_texture_half_float_linear"),shader_texture_lod:s||dt(e,"EXT_shader_texture_lod"),standard_derivatives:s||dt(e,"OES_standard_derivatives"),blend_minmax:s||dt(e,"EXT_blend_minmax"),seamless_cube_map:dt(e,"OES_seamless_cube_map"),vertex_array_object:s||dt(e,"OES_vertex_array_object"),filter_anisotropic:r=dt(e,"EXT_texture_filter_anisotropic")||dt(e,"texture_filter_anisotropic")||dt(e,"MOZ_EXT_texture_filter_anisotropic")||dt(e,"WEBKIT_EXT_texture_filter_anisotropic"),maxAnisotropy:r?e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,frag_depth:s||dt(e,"EXT_frag_depth"),depth_texture:s||dt(e,"WEBGL_depth_texture"),element_index_uint:s||dt(e,"OES_element_index_uint")}}(this),this.maxParams={MAX_VERTEX_ATTRIBS:(n=this.context).getParameter(34921),MAX_VARYING_VECTORS:n.getParameter(36348),MAX_VERTEX_UNIFORM_VECTORS:n.getParameter(36347),MAX_FRAGMENT_UNIFORM_VECTORS:n.getParameter(36349),MAX_TEXTURE_IMAGE_UNITS:n.getParameter(34930),MAX_VERTEX_TEXTURE_IMAGE_UNITS:n.getParameter(35660),MAX_TEXTURE_SIZE:n.getParameter(3379),MAX_CUBE_MAP_TEXTURE_SIZE:n.getParameter(34076),MAX_VIEWPORT_DIMS:n.getParameter(3386),MAX_RENDERBUFFER_SIZE:n.getParameter(34024),MAX_COMBINED_TEXTURE_IMAGE_UNITS:n.getParameter(35661)},this.renderState=new lt(this);const a=new V(this);a.init("default","attribute vec3 aPos;attribute vec2 aUV0;varying vec2 vUV;void main(void) {vUV = aUV0;gl_Position = vec4(aPos, 1.0);}","precision mediump float;varying vec2 vUV; uniform sampler2D _Texture; void main(void) { gl_FragColor = texture2D(_Texture, vUV); }"),this.blitMat=new _(this,"default",a),this.blitMat.depthTest=!1,this.blitMat.depthWrite=!1,this.blitMesh=function(t){const e=new rt(t),s=new Float32Array([-1,-1,0,-1,3,0,3,-1,0]);e.setPositions(s);const r=new Float32Array([0,0,0,2,2,0]);e.setUV0(r);const i=new Uint16Array([0,2,1]);return e.setIndices(i),e}(this),this.canvas.addEventListener("resize",(()=>this.handleCanvasResize()))}get clearColor(){return this._clearColor}set clearColor(t){this._clearColor.copy(t),this.context.clearColor(t.r,t.g,t.b,t.a)}get size(){return this._size}get mouseListener(){return this._mouseListener||(this._mouseListener=new Tt(this.options.mouseEventsElement||this.canvas,this.canvas)),this._mouseListener}get renderTarget(){return this._rt}set renderTarget(t){t?(t.scaleToCanvas&&t.setSize(Math.round(this.canvas.width*t.sizeMultiplier),Math.round(this.canvas.height*t.sizeMultiplier)),t.setAsTarget(),this.setSize(t.width,t.height),this._rt=t):this.unsetRenderTarget()}get width(){return this._size.x}get height(){return this._size.y}get aspectRatio(){return this.width/this.height}init(){this.unsetRenderTarget(),this.handleCanvasResize()}preprocessShaderString(t){return t}draw(t,e,s=0,r=-1){}startBatch(t,e){}drawElements(t,e,s=0,r=-1){}endBatch(){}handleCanvasResize(){this.setSize(this.canvas.width,this.canvas.height)}enablePointSprites(){this.context.enable(34370)}blit(t=null,e=null,s=null,r=!1,i=!0){const n=null!=s?s:this.blitMat;e&&(this.renderTarget=e),t&&n.setTexture("_Texture",t),r&&(e&&e.hasDepth()?this.clear():this.context.clear(17408)),this.draw(this.blitMesh,n),e&&i&&this.unsetRenderTarget(),t&&n.unSetTexture("_Texture")}unsetRenderTarget(t=!1){if(this._rt||t){const t=this.context;t.bindFramebuffer(36160,null),t.bindRenderbuffer(36161,null),this.setSize(this.canvas.width,this.canvas.height)}this._rt=null}clearWithColor(t=0,e=0,s=0,r=0){this.context.clearColor(t,e,s,r),this.context.depthMask(!0),this.context.clear(17664),this.context.depthMask(this.renderState.getDepthMask()),this.context.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a)}clearRenderTexture(t,e=0,s=0,r=0,i=0){this.renderTarget=t,this.clearWithColor(e,s,r,i),this.unsetRenderTarget()}clearDepth(){this.renderState.setDepthMask(!0),this.context.clear(256)}clear(){this.renderState.getDepthMask()||this.context.depthMask(!0),this.context.clear(17664),this.renderState.getDepthMask()||this.context.depthMask(this.renderState.getDepthMask())}setSize(t,e){t|=0,e|=0,this.width===t&&this.height===e||(this._size.setValues(t,e),this.context.viewport(0,0,this.width,this.height))}setScissor(t,e,s,i,n=!1){t=r(t),e=r(e);const a=(s=r(s))-t,h=(i=r(i))-e,o=this.width,c=this.height;this.context.enable(g),this.context.scissor(t*o|0,e*c|0,a*o|0,h*c|0),n&&this.context.viewport(t*o|0,e*c|0,a*o|0,h*c|0)}setScissorPixels(t,e,s,r){this.context.enable(g),this.context.scissor(t,e,s-t,r-e)}unsetScissor(){this.context.disable(g)}setViewPort(t,e,s,r){this._size.setValues(s,r),this.context.viewport(t,e,this.width,this.height)}unsetViewPort(){this._size.setValues(this.canvas.width,this.canvas.height),this.context.viewport(0,0,this.canvas.width,this.canvas.height)}setChannelMask(t=!1,e=!1,s=!1,r=!1){this.context.colorMask(t,e,s,r)}clearChannelMask(){this.context.colorMask(!0,!0,!0,!0)}setStencilEnabled(t){t?this.context.enable(2960):this.context.disable(2960)}startDrawToStencil(){const t=this.context;this.setStencilEnabled(!0),t.stencilFunc(519,1,255),t.stencilOp(7680,7680,7681),t.stencilMask(255)}setStencilFuncEqual(t){this.context.stencilFunc(t?514:517,1,255)}destructVAO(t){}destruct(){l.log("Renderer: destruct");const t=this.context;this._fb.forEach((e=>{t.deleteFramebuffer(e)}));const e=t.getParameter(34930);for(let r=0;r<e;++r)t.activeTexture(t.TEXTURE0+r),t.bindTexture(t.TEXTURE_2D,null),t.bindTexture(t.TEXTURE_CUBE_MAP,null);t.bindBuffer(m,null),t.bindBuffer(x,null),t.bindRenderbuffer(36161,null),t.bindFramebuffer(36160,null),t.useProgram(null);const s=t.getExtension("WEBGL_lose_context");s&&s.loseContext(),this.blitMesh&&this.blitMesh.destruct(),this.blitMat&&this.blitMat.destruct(),this.canvas.removeEventListener("resize",this.handleCanvasResize),this._mouseListener&&this._mouseListener.destruct()}getFramebuffer(){const t=this._fb.pop();return t||this.context.createFramebuffer()}releaseFramebuffer(t){this._fb.push(t)}}class Ot extends Rt{constructor(t,s={}){super(t,"webgl",s),e(this,"vertexArrayObjects"),e(this,"currentVAO"),this.vertexArrayObjects={}}initVAO(t,e){const s=this.extensions.vertex_array_object,r=s.createVertexArrayOES();return s.bindVertexArrayOES(r),this.setStates(t,e),s.bindVertexArrayOES(null),r}setStates(t,e){const s=this.context;if(t.isInterleaved()){t.interleaveData(),s.bindBuffer(m,t.interleavedBuffer);let r=0;t.attributes.forEach((i=>{const n=e.shader.getAttributeByName(i.name);n&&(s.enableVertexAttribArray(n.loc),s.vertexAttribPointer(n.loc,n.stride,p,!1,4*t.interleavedStrideSum,r)),r+=4*i.stride}))}else t.attributes.forEach((t=>{const r=e.shader.getAttributeByName(t.name);if(r){if(null===t.buffer)throw new ReferenceError("Expected buffer to be defined on VertexAttribute when setting states.");s.bindBuffer(m,t.buffer),s.enableVertexAttribArray(r.loc),s.vertexAttribPointer(r.loc,r.stride,p,!1,4*r.stride,0)}}));t.indexBuffer&&s.bindBuffer(x,t.indexBuffer)}getVAO(t,e){let s,r=this.vertexArrayObjects[t.id];return r?(s=r[e.id],s||(s=this.initVAO(t,e),r[e.id]=s)):(r={},s=this.initVAO(t,e),r[e.id]=s,this.vertexArrayObjects[t.id]=r),s}drawVAO(t,e,s,r=0,i=-1){s.setActive(),this.bindVAO(t),this.drawElements(e,s,r,i),this.bindVAO(null)}destruct(){l.log("RendererWebGL1: destruct");const t=this.extensions.vertex_array_object;if(t&&this.vertexArrayObjects)for(let e=0;e<this.vertexArrayObjects.length;e++)t.deleteVertexArrayOES(this.vertexArrayObjects[e]);super.destruct()}destructVAO(t){const e=this.extensions.vertex_array_object;if(e){const s=this.vertexArrayObjects[t.id];for(const t in s){const r=s[t];e.deleteVertexArrayOES(r)}this.vertexArrayObjects[t.id]=[]}}draw(t,e,s=0,r=-1){e.setActive();if(!this.extensions.vertex_array_object||t.isDynamic)this.setStates(t,e),this.drawElements(t,e,s,r);else{const i=this.getVAO(t,e);this.bindVAO(i),this.drawElements(t,e,s,r),this.bindVAO(null)}}drawElements(t,e,s=0,r=-1){if(t.indices)r>0?this.context.drawElements(e.drawType,Math.min(r,t.indices.length),t.indexType,s*(t.indexType==w?2:4)):this.context.drawElements(e.drawType,t.indices.length,t.indexType,0);else{const i=t.vertexCount-s;r>0?this.context.drawArrays(e.drawType,s,Math.min(i,r)):this.context.drawArrays(e.drawType,s,i)}}endBatch(){this.extensions.vertex_array_object&&this.extensions.vertex_array_object.bindVertexArrayOES(null)}preprocessShaderString(t){return"#define WEBGL1\n"+t}startBatch(t,e){e.setActive();this.extensions.vertex_array_object?this.extensions.vertex_array_object.bindVertexArrayOES(this.getVAO(t,e)):this.setStates(t,e)}bindVAO(t){const e=this.extensions.vertex_array_object;t!=this.currentVAO&&(e.bindVertexArrayOES(t),this.currentVAO=t)}}function Vt(t){return t*t*(3-2*t)}class Lt{constructor(t){e(this,"_from"),e(this,"_target"),e(this,"currentValue"),e(this,"duration",0),e(this,"_progress",1),e(this,"easing",Vt),e(this,"onProgress"),e(this,"onComplete"),e(this,"clone"),e(this,"_lerp"),this.from=t}get from(){return this._from}set from(t){void 0!==t&&(void 0===this.clone&&(this.clone=t=>t.clone(),"number"==typeof t?(this.clone=t=>t,this._lerp=s):t instanceof d?this._lerp=d.lerp:t instanceof U?this._lerp=U.lerp:t instanceof F?this._lerp=F.lerp:t instanceof X&&(this._lerp=X.slerp)),this._from=this.clone(t),this.currentValue=this.clone(t))}get completed(){return this.progress>=1}get progress(){return this._progress}get easedProgress(){return this.easing(this._progress)}get value(){return this.currentValue}get target(){return this._target}to(t,e,s=void 0,r=void 0,i=Vt){return void 0===this.from&&l.error("Tween.to without setting from value"),this.from=this.currentValue,this._target=this.clone(t),this.duration=e,this._progress=0,this.onProgress=s,this.onComplete=r,this.easing=i,this}fromTo(t,e,s,r=void 0,i=void 0,n=Vt){return this.from=t,this.to(e,s,r,i,n)}stop(){return this.cancel()}cancel(){return this._progress=1,this.onProgress=void 0,this.onComplete=void 0,this}update(t){this._progress<1&&(this._progress=this.duration<=0?1:r(this._progress+t/this.duration),this.currentValue=this._lerp(this.from,this._target,r(this.easing(this._progress))),void 0!==this.onProgress&&this.onProgress(this.value),this._progress>=1&&this.onComplete&&this.onComplete())}}class Ut{constructor(t,s,r,i="screensaver"){var n;e(this,"play",!1),e(this,"renderer"),e(this,"canvasManager"),e(this,"materials",[]),e(this,"mesh"),e(this,"indexCount",0),e(this,"camera"),e(this,"zPos",0),e(this,"layers",[]),e(this,"pathPositions",[]),e(this,"penOpacity",0),e(this,"whiteMode",0),e(this,"fade",new Lt(0)),"undefined"!=typeof require?P((n=require.context("./shaders",!0)).keys().reduce(((t,e)=>({...t,[e]:n(e)})),{})):P(Object.assign({"./shaders/line/line.fs.glsl":"precision highp float;\r\n\r\nuniform highp float _Time;\r\nuniform highp float _Progress;\r\nuniform float _Layer;\r\nuniform float _AspectRatio;\r\n\r\nvarying float vOpacity;\r\nvarying float vBrightness;\r\nvarying highp float vProgress;\r\nvarying vec3 vPos;\r\nvarying vec2 vScreen;\r\n\r\nfloat hash12(vec2 p) {\r\n    vec3 p3  = fract(vec3(p.xyx) * .1031);\r\n    p3 += dot(p3, p3.yzx + 33.33);\r\n    return fract((p3.x + p3.y) * p3.z);\r\n}\r\n\r\n\r\nfloat vignette() {\r\n#ifdef HEADER\r\n    vec2 uv = vScreen-.5;\r\n    uv.x *= _AspectRatio * .75;\r\n    return min(dot(uv,uv) + .25, 1.) * 0.9;\r\n#else\r\n    vec2 uv = clamp(vScreen, 0., 1.);\r\n    uv *=  1.0 - uv.yx;\r\n    return mix(1., pow(uv.x*uv.y*16., .25), 1.);\r\n#endif\r\n}\r\n\r\n\r\nvoid main() {\r\n    if (vProgress > _Progress) {\r\n        discard;\r\n    }\r\n    float a = vOpacity;\r\n\r\n    #ifdef WHITE\r\n    float b = (1. - vBrightness * vignette()) * vOpacity;\r\n    #else\r\n    float b = (vBrightness * vignette()) * vOpacity;\r\n    #endif\r\n\r\n    b += hash12(gl_FragCoord.xy) * (2./255.);\r\n\r\n    gl_FragColor = vec4(b, b, b, a);\r\n}\r\n","./shaders/line/line.vs.glsl":"precision mediump float;\r\n\r\nattribute vec4 aData;\r\n\r\nuniform float _Aspect;\r\nuniform mat4 _ViewProjection;\r\nuniform mat4 _Model;\r\nuniform float _Opacity;\r\nuniform vec3 _CamPos;\r\nuniform float _VertexCount;\r\n\r\nvarying float vOpacity;\r\nvarying float vBrightness;\r\nvarying highp float vProgress;\r\nvarying vec3 vPos;\r\nvarying vec2 vScreen;\r\n\r\nfloat hash11(float p) {\r\n    p = fract(p * .1031);\r\n    p *= p + 33.33;\r\n    p *= p + p;\r\n    return fract(p);\r\n}\r\n\r\nvoid main(void) {\r\n    vPos = aData.xyz;\r\n    vec4 pos = _Model * vec4(aData.xyz, 1.0);\r\n\r\n    float dist = length(pos.xyz - _CamPos);\r\n\r\n    gl_Position = _ViewProjection * pos;\r\n\r\n    vBrightness = clamp(1./(.01 + dist * 1.25), 0.0, 1.0) * smoothstep(4.25, 3., dist) + (2./255.) * hash11(aData.w);\r\n    vOpacity = _Opacity * smoothstep(0.05, 0.35, dist) + (1./255.) * hash11(aData.w);\r\n\r\n    vScreen = gl_Position.xy / gl_Position.w * .5 + .5;\r\n    vProgress = aData.w / _VertexCount;\r\n}","./shaders/lineMesh/lineMesh.fs.glsl":"#extension GL_OES_standard_derivatives : enable\r\n\r\nprecision highp float;\r\n\r\nuniform highp float _Time;\r\nuniform highp float _Progress;\r\nuniform float _Layer;\r\n\r\nvarying float vOpacity;\r\nvarying float vBrightness;\r\nvarying highp float vProgress;\r\nvarying vec3 vPos;\r\nvarying vec2 vScreen;\r\nvarying float vY;\r\n\r\nfloat vignette() {\r\n\tvec2 uv = clamp(vScreen, 0., 1.);\r\n\tuv *=  1.0 - uv.yx;\r\n\treturn mix(1., pow(uv.x*uv.y*16., .25), 1.);\r\n}\r\n\r\nfloat aa(in float x){\r\n\tfloat f = fwidth(x) * 1.5;\r\n\t//abs does not work well on thin lines\r\n\tfloat a = smoothstep(1., 1. -f, x);\r\n\treturn a *smoothstep(-1., -1. + f, x);\r\n}\r\n\r\nvoid main() {\r\n//\tgl_FragColor = vec4(1,0,0,1) * aa(vY);\r\n//\treturn;\r\n\r\n\tif (abs(vPos.x) > 1. || abs(vPos.y) > 1. || vProgress > _Progress) {\r\n\t\tdiscard;\r\n\t}\r\n\tfloat a = vOpacity * aa(vY);\r\n\r\n\t#ifdef WHITE\r\n\tfloat b = (1. - vBrightness * vignette()) * vOpacity;\r\n\t#else\r\n\tfloat b = (vBrightness * vignette()) * vOpacity;\r\n\t#endif\r\n\r\n\tgl_FragColor = vec4(b, b, b, a);\r\n}","./shaders/lineMesh/lineMesh.vs.glsl":"attribute vec4 aData0;\r\nattribute vec4 aData1;\r\n//-1 to 1\r\nattribute vec2 aUV0;\r\n\r\nuniform mat4 _Model;\r\nuniform mat4 _ViewProjection;\r\nuniform float _AspectRatio;\r\nuniform float _ScreenHeight;\r\nuniform float _VertexCount;\r\nuniform float _Opacity;\r\nuniform vec3 _CamPos;\r\n\r\nuniform float uLineWidth;\r\nuniform float uConstantThickness;\r\n\r\nvarying float vOpacity;\r\nvarying float vBrightness;\r\nvarying highp float vProgress;\r\nvarying vec3 vPos;\r\nvarying vec2 vScreen;\r\nvarying float vY;\r\n\r\nvoid main(void) {\r\n\tvec4 p0 = _Model * vec4(aData0.xyz, 1);\r\n\tvec4 p1 = _Model * vec4(aData1.xyz, 1);\r\n\r\n\tfloat dist = length(p0.xyz - _CamPos);\r\n\r\n\tvec4 s0 = _ViewProjection * p0;\r\n    vec4 s1 = _ViewProjection * p1;\r\n\r\n   \tgl_Position = s0;\r\n\r\n    s0.xy /= s0.w;\r\n    s1.xy /= s1.w;\r\n\r\n    vec2 dir = normalize(s1.xy -  s0.xy);\r\n\tvec2 crs = vec2(-dir.y, dir.x);\r\n\tcrs.x /= _AspectRatio;\r\n\r\n\tfloat width = aUV0.x * aUV0.y * uLineWidth / _ScreenHeight ;\r\n\twidth *= mix(1., s0.w, uConstantThickness);\r\n\r\n    gl_Position.xy += crs * width;\r\n\r\n\tvY = aUV0.y;\r\n\r\n\tvBrightness = clamp(1./(.1 + dist * 1.25), 0.0, 1.0) * smoothstep(4.25, 3., dist);\r\n\tvOpacity = _Opacity * smoothstep(0.05, 0.35, dist);\r\n\r\n\tvScreen = gl_Position.xy / gl_Position.w * .5 + .5;\r\n\tvProgress = aData0.w / _VertexCount;\r\n }\r\n"})),this.canvasManager=new u(t),this.renderer=new Ot(this.canvasManager.canvas,{antialias:!0,alpha:!1,premultipliedAlpha:!1});for(let e=0;e<2;e++){const t=new L(this.renderer,s,"line");t.setDrawTypeLines(),t.setPreMultipliedAlphaBlending(),t.setCullingDisabled(),1===e&&t.addShaderDefines("WHITE"),"header"===i&&t.addShaderDefines("HEADER"),this.materials.push(t)}this.camera=new G(1,1e-4,10),"header"===i&&(this.penOpacity=-1,this.renderer.clearWithColor(0,0,0,1),this.renderer.clearColor=new ct(0,0,0,1))}init(){this.renderer.init()}initLayers(t,e){this.clear();let s=[];s=function(t){const e=[];let s=2;return t.forEach((t=>{for(let r=0;r<t.length-1;r++)e.push(new F(t[r].x,t[r].y,t[r].z,s)),e.push(new F(t[r+1].x,t[r+1].y,t[r+1].z,s+1)),s++})),e}(function(t){const e=new U(.01,-.01,0),s=[];return t.forEach((t=>{const r=[];t.forEach(((e,s)=>{if(r.length>0){const i=r[r.length-1],n=U.distance(i,new U(e[0],e[1],0));if(n<.15&&s<t.length-1)return;if(n>2){const t=n/2|0;for(let s=0;s<t;s++)r.push(U.lerp(i,new U(e[0],e[1],0),(s+1)/t));return}}r.push(new U(e[0],e[1],0))})),r.forEach((t=>t.multiply(e))),s.push(r)})),s}(t)),this.mesh=it(this.renderer,s),this.pathPositions=s,this.indexCount=s.length/2|0,this.canvasManager.update(0),this.renderer.setSize(this.canvasManager.canvas.width,this.canvasManager.canvas.height);for(let i=0;i<5;i++){const t=new Y;t.reset(this.zPos-5,i-5,this.pathTransform(i),this.pathPositions,(r=this.renderer.aspectRatio,!isNaN(parseFloat(r))&&isFinite(r)?this.renderer.aspectRatio:2)),this.layers.push(t)}var r;return this.penOpacity=i(Math.abs(e),.1,1),this.whiteMode=e>0?1:0,this.fade.fromTo(0,1,2),this.play||(this.play=!0,this.update()),!0}clear(){this.play=!1,this.mesh&&(this.mesh.destruct(),this.mesh=void 0),this.pathPositions=[],this.layers=[],this.zPos=0}update(t=0){if(!this.play)return;window.requestAnimationFrame((t=>this.update(t))),ot.instance.update(t);const e=ot.instance.dt;if(this.canvasManager.update(e),this.whiteMode>0?this.renderer.clearWithColor(1,1,1,1):this.renderer.clearWithColor(0,0,0,1),!this.mesh)return;this.fade.update(e),this.zPos+=.07*e,this.camera.copy(this.pathTransform(this.zPos)),this.camera.projection.FOV=Math.min(1.5,1.8/this.renderer.aspectRatio),this.camera.projection.aspectRatio=this.renderer.aspectRatio;const s=this.materials[this.whiteMode];s.setFloat("_Opacity",this.penOpacity*this.fade.value),s.setFloat("_Time",ot.instance.time),s.setMatrix("_ViewProjection",this.camera.viewProjection),s.setVector3("_CamPos",this.camera.worldPosition),s.setFloat("_VertexCount",this.mesh.vertexCount/2),s.setFloat("_AspectRatio",this.renderer.aspectRatio),this.layers.forEach((t=>{if(t.update(this.zPos),t.zPos<this.zPos-.5){const e=Math.round(t.zPos+this.layers.length);t.reset(this.zPos,e,this.pathTransform(e),this.pathPositions,this.renderer.aspectRatio)}})),this.layers.sort(((t,e)=>e.zPos-t.zPos));const r=new W;this.layers.forEach(((t,e)=>{if(!this.mesh)return;const i=(this.indexCount-1)*t.progress|0;r.parent=t.model,s.setFloat("_Progress",t.progress),s.setFloat("_Layer",10*e+1);for(let n=-2;n<=2;n+=2)for(let t=-2;t<=2;t+=2)r.position=new U(n,t,0),s.setMatrix("_Model",r.worldMatrix),this.renderer.draw(this.mesh,s,0,2*i)}))}destruct(){}pathPosition(t){return new U(.1*Math.sin(1.618033988749895*t*1.3),.1*Math.cos(1.3*t+2.3999632297286535)-.5*t,-t)}pathTransform(t){const e=new W;return e.lookAt(this.pathPosition(t),this.pathPosition(t+.2),new U(0,1,0)),e}}let Ft=!1;function It(t,e){if(Ft)return;if(t.reduce(((t,e)=>t+e.length),0)>5e5)return!1;Ft=!0;const s=document.getElementById("webgl-container");return s.classList.remove("d-none"),!!Bt.initLayers(t,e)||(s.classList.add("d-none"),!1)}window.startScreenSaver=async function(t,e,s="screensaver"){return new Promise((r=>{if(Bt)r(It(t,e));else{const i=new n,a=document.getElementById("webgl-container");Bt=new Ut(a,i,!1,s),i.load((()=>{Bt.init(),r(It(t,e))}))}}))},window.stopScreenSaver=function(){if(Ft&&(Ft=!1,Bt)){Bt.clear();document.getElementById("webgl-container").classList.add("d-none")}};
